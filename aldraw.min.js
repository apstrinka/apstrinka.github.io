"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var s=n.lastIndexOf(t,e);return-1!==s&&s===e});var AlDrawModule=function(){var t={defaultTolerance:1e-5,isBetween:function(t,e,n){return t<=e+this.defaultTolerance&&t>=n-this.defaultTolerance||t>=e-this.defaultTolerance&&t<=n+this.defaultTolerance},floatsEqual:function(t,e){return!Number.isFinite(t)&&!Number.isFinite(e)||Math.abs(t-e)<this.defaultTolerance},round:function(t,e){var n=Math.pow(10,-e);return Math.round(t*n)/n},midPoint:function(t,e){return new n((t.x+e.x)/2,(t.y+e.y)/2)},perpendicularSlope:function(e){var n=Number.POSITIVE_INFINITY;return t.floatsEqual(e,0)||(n=-1/e),n},comparePointToLine:function(e,n){var s=n.getSlope(),i=n.getIntercept(),o=0;if(Number.isFinite(s)){var r=s*e.x+i;o=t.floatsEqual(e.y,r)?0:e.y>r?1:-1}else o=t.floatsEqual(e.x,i)?0:e.x>i?1:-1;return o},normalizeAngle:function(t){var e=t%(2*Math.PI);return e<0&&(e+=2*Math.PI),this.floatsEqual(e,2*Math.PI)&&(e=0),e},angleSum:function(e,n){var s=e+n;return t.normalizeAngle(s)},angleDifference:function(e,n){var s=e-n;return s=t.normalizeAngle(s)},smallerAngleDifference:function(e,n){return Math.min(t.angleDifference(e,n),t.angleDifference(n,e))},oppositeAngle:function(e){return t.angleSum(e,Math.PI)},angleToSlope:function(e){var n=Math.tan(e);return(t.floatsEqual(e,Math.PI/2)||t.floatsEqual(e,3*Math.PI/2))&&(n=Number.POSITIVE_INFINITY),n},slopeToAngle:function(e){var n=Math.atan(e);return n=t.normalizeAngle(n)},toRadians:function(t){return t*Math.PI/180},toDegrees:function(t){return 180*t/Math.PI},arrayContains:function(t,e){for(var n=t.length,s=0;s<n;s++)if(e.equals(t[s]))return!0;return!1},arrayIndexOf:function(t,e,n){void 0===n&&(n=0);for(var s=t.length,i=n;i<s;i++)if(e.equals(t[i]))return i;return-1},arrayLastIndexOf:function(t,e){for(var n=t.length-1;n>=0;n--)if(e.equals(t[n]))return n;return-1}};function e(t,e,n){this.red=t,this.green=e,this.blue=n}function n(t,e){this.x=t,this.y=e}function s(e,n,s,i){var o,r,a=e.comparePathableTo(s),c=e.comparePathableTo(i);if(a===n&&c!==n)return-1;if(c===n&&a!==n)return 1;var l=e.distanceAlong(s),h=e.distanceAlong(i),u=e.angleDifference(s);-1===a&&t.floatsEqual(u,0)&&(u=2*Math.PI);var p=e.angleDifference(i);return-1===c&&t.floatsEqual(p,0)&&(p=2*Math.PI),a===n?t.floatsEqual(l,h)?t.floatsEqual(u,p)?(o=s.curvature(),r=i.curvature(),t.floatsEqual(o,r)?0:o>r?-n:n):u>p?-n:n:l<h?-1:1:t.floatsEqual(l,h)?t.floatsEqual(u,p)?(o=s.curvature(),r=i.curvature(),t.floatsEqual(o,r)?0:o>r?-n:n):u>p?-n:n:l<h?1:-1}e.prototype.toString=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"},e.prototype.darker=function(){return new e(4*this.red/5,4*this.green/5,4*this.blue/5)},n.fromObject=function(t){return new n(t.x,t.y)},n.prototype.dist=function(t){return Math.hypot(this.x-t.x,this.y-t.y)},n.prototype.angle=function(e){var n=Math.atan2(e.y-this.y,e.x-this.x);return n=t.normalizeAngle(n)},n.prototype.translate=function(t,e){return new n(this.x+t,this.y+e)},n.prototype.rotateAroundOrigin=function(t){return new n(Math.cos(t)*this.x-Math.sin(t)*this.y,Math.sin(t)*this.x+Math.cos(t)*this.y)},n.prototype.equals=function(e){return t.floatsEqual(this.x,e.x)&&t.floatsEqual(this.y,e.y)},n.prototype.draw=function(t,n,s){void 0===s&&(s=new e(0,255,0));var i=n.abstractToScreenCoord(this),o=t.fillStyle;t.fillStyle=s.darker().toString(),t.beginPath(),t.arc(i.x,i.y,6,0,2*Math.PI),t.fill(),t.fillStyle=s.toString(),t.beginPath(),t.arc(i.x,i.y,3,0,2*Math.PI),t.fill(),t.fillStyle=o};var i={intersect:function(t){return t.isA("AbstractLine")?this.intersectLine(t):t.isA("Circle")?this.intersectCircle(t):void console.log("This should never happen")},angleDifference:function(e){var n=this.angleAtPoint(e.startPoint()),s=e.angleAtStart();return t.angleDifference(s,n)},comparePathableTo:function(e){var n=this.angleDifference(e);return t.floatsEqual(n,0)?t.floatsEqual(e.curvature(),this.curvature())?0:e.curvature()<this.curvature()?-1:1:t.floatsEqual(n,Math.PI)?t.floatsEqual(e.curvature(),-this.curvature())?0:e.curvature()<-this.curvature()?1:-1:n<Math.PI?1:-1},comparePointTo:function(t){var e=new c(this.closestPoint(t),t);return this.comparePathableTo(e)},getIntersectionsInOrder:function(e,n){for(var i=[],o=(g=n.getPathables()).length,r=0;r<o;r++)for(var a=g[r],c=this.intersect(a),l=0;l<c.length;l++)if(null!==c[l]&&!c[l].equals(this.startPoint()))for(var u=a.divide(c[l]),p=0;p<u.length;p++)(this.canSwitchSides()||this.comparePathableTo(u[p])===e)&&i.push(u[p]);var f=this;if(i.sort(function(t,n){return s(f,e,t,n)}),this.isA("arc")&&t.floatsEqual(this.sweep,2*Math.PI)){var d=[],g=n.getPathables();for(r=0;r<g.length;r++)for(a=g[r],c=this.intersect(a),l=0;l<c.length;l++)if(null!==c[l]&&c[l].equals(this.startPoint()))for(u=a.divide(c[l]),p=0;p<u.length;p++)this.comparePathableTo(u[p])===e&&d.push(u[p]);d.sort(function(t,n){return s(f,e,t,n)}),(i=i.concat(d)).push(new h(this.center,this.radius,this.start,this.sweep,this.inverse))}return i}},o=Object.create(i);function r(t,e){this.slope=t,this.intercept=e}function a(t,e){this.start=t,this.angle=e}function c(t,e){this.p1=t,this.p2=e}function l(t,e){this.center=t,this.radius=e}function h(t,e,n,s,i){this.center=t,this.radius=e,this.start=n,this.sweep=s,this.inverse=void 0!==i&&i}function u(t,e){this.path=t,this.color=e}function p(){this.width=1500,this.height=500,this.cX=0,this.cY=0,this.conversionRatio=250,this.angle=0,this.zoomAmt=1.2}function f(){this.enclosures=[],this.segments=[],this.rays=[],this.lines=[],this.arcs=[],this.circles=[],this.points=[],this.next=null,this.previous=null}o.getSlope=function(){console.log("getSlope() hasn't been implemented"),console.trace()},o.getIntercept=function(){console.log("getIntercept() hasn't been implemented"),console.trace()},o.contains=function(){console.log("contains() hasn't been implemented"),console.trace()},o.distance=function(t){var e=this.getSlope(),n=this.getIntercept(),s=t.x,i=t.y;return Number.isFinite(e)?Math.abs(i-e*s-n)/Math.hypot(e,1):Math.abs(s-n)},o.curvature=function(){return 0},o.intersectLine=function(e){var s,i,o=this.getSlope(),r=this.getIntercept(),a=e.getSlope(),c=e.getIntercept();if(t.floatsEqual(o,a))return[];i=Number.isFinite(o)?Number.isFinite(a)?o*(s=(c-r)/(o-a))+r:o*(s=c)+r:a*(s=r)+c;var l=new n(s,i);return this.contains(l)&&e.contains(l)?[l]:[]},o.intersectCircle=function(e){var s=e.center.x,i=e.center.y,o=e.radius,r=this.getSlope(),a=this.getIntercept(),c=[],l=[];if(t.floatsEqual(this.distance(e.center),o)){var h=this.closestPoint(e.center);return e.contains(h)?[h]:[]}if(Number.isFinite(r)){var u=1+Math.pow(r,2),p=2*(r*a-s-r*i),f=Math.pow(s,2)+Math.pow(a,2)-2*a*i+Math.pow(i,2)-Math.pow(o,2),d=Math.pow(p,2)-4*u*f;if(d<0)return[];var g=(-p+Math.sqrt(d))/(2*u);c.push(new n(g,r*g+a)),g=(-p-Math.sqrt(d))/(2*u),c.push(new n(g,r*g+a))}else{if(a<s-o||a>s+o)return[];c.push(new n(a,i+Math.sqrt(Math.pow(o,2)-Math.pow(a-s,2)))),c.push(new n(a,i-Math.sqrt(Math.pow(o,2)-Math.pow(a-s,2))))}var v,w=c.length;for(v=0;v<w;v++)this.contains(c[v])&&e.contains(c[v])&&l.push(c[v]);return l},o.parallel=function(e){return t.floatsEqual(this.getSlope(),e.getSlope())},o.same=function(e){return t.floatsEqual(this.getSlope(),e.getSlope())&&t.floatsEqual(this.getIntercept(),e.getIntercept())},r.fromObject=function(t){return new r(t.slope,t.intercept)},r.fromTwoPoints=function(e,n){var s;return new r(s=t.floatsEqual(e.x,n.x)?Number.POSITIVE_INFINITY:(n.y-e.y)/(n.x-e.x),Number.isFinite(s)?e.y-s*e.x:e.x)},r.fromPointSlope=function(t,e){return new r(e,Number.isFinite(e)?t.y-e*t.x:t.x)},r.prototype=Object.create(o),r.prototype.isA=function(t){return"Line"===t||"AbstractLine"===t},r.prototype.getSlope=function(){return this.slope},r.prototype.getIntercept=function(){return this.intercept},r.prototype.closestPoint=function(e){var n=0;t.floatsEqual(this.getSlope(),0)?n=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(n=-1/this.getSlope());var s=r.fromPointSlope(e,n);return this.intersectLine(s)[0]},r.prototype.canSwitchSides=function(){return!1},r.prototype.divide=function(e){this.contains(e)||(e=this.closestPoint(e));var n=t.slopeToAngle(this.slope);return[new a(e,n),new a(e,t.oppositeAngle(n))]},r.prototype.contains=function(e){return Number.isFinite(this.slope)?t.floatsEqual(e.y,this.slope*e.x+this.intercept):t.floatsEqual(this.intercept,e.x)},r.prototype.getPortionInsideRectangle=function(e){for(var n=[],s=e.length,i=0;i<s;i++)for(var o=this.intersectLine(e[i]),r=o.length,a=0;a<r;a++)t.arrayContains(n,o[a])||n.push(o[a]);return n.length>=2?new c(n[0],n[1]):null},r.prototype.draw=function(t,e){var n=e.getAbstractBoundaries(),s=this.getPortionInsideRectangle(n);null!=s&&s.draw(t,e)},r.prototype.equals=function(e){return this===e||null!=e&&(!!e.isA("Line")&&(t.floatsEqual(this.intercept,other.intercept)&&t.floatsEqual(this.slope,other.slope)))},a.fromObject=function(t){return new a(n.fromObject(t.start),t.angle)},a.fromTwoPoints=function(t,e){var n=t.angle(e);return new a(t,n)},a.prototype=Object.create(o),a.prototype.isA=function(t){return"Ray"===t||"AbstractLine"===t},a.prototype.getSlope=function(){return t.floatsEqual(this.angle,Math.PI/2)?Number.POSITIVE_INFINITY:t.floatsEqual(this.angle,3*Math.PI/2)?Number.NEGATIVE_INFINITY:Math.tan(this.angle)},a.prototype.getIntercept=function(){var t=this.getSlope();return Number.isFinite(t)?this.start.y-t*this.start.x:this.start.x},a.prototype.closestPoint=function(e){var n=0;t.floatsEqual(this.getSlope(),0)?n=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(n=-1/this.getSlope());var s=r.fromPointSlope(e,n),i=this.intersectLine(s);return i.length>0?i[0]:this.start},a.prototype.startPoint=function(){return this.start},a.prototype.angleAtStart=function(){return this.angle},a.prototype.angleAtPoint=function(t){return this.angle},a.prototype.canSwitchSides=function(){return!1},a.prototype.distance=function(t){return this.closestPoint(t).dist(t)},a.prototype.distanceAlong=function(t){var e=t.startPoint();return this.start.dist(e)},a.prototype.divide=function(t){return this.contains(t)||(t=this.closestPoint(t)),this.start.equals(t)?[new a(t,this.angle)]:[new c(t,this.start),new a(t,this.angle)]},a.prototype.shortened=function(t){return new c(this.startPoint(),t.startPoint())},a.prototype.contains=function(e){var n=this.start.angle(e);return t.floatsEqual(n,this.angle)||e.equals(this.start)},a.prototype.getPortionInsideRectangle=function(e){for(var n=[this.start],s=e.length,i=0;i<s;i++)for(var o=this.intersectLine(e[i]),r=o.length,a=0;a<r;a++)t.arrayContains(n,o[a])||n.push(o[a]);return 2===n.length?new c(n[0],n[1]):n.length>2?new c(n[1],n[2]):null},a.prototype.sameDirection=function(t){return this.equals(t)},a.prototype.draw=function(t,e){var n=e.getAbstractBoundaries(),s=this.getPortionInsideRectangle(n);null!=s&&s.draw(t,e)},a.prototype.equals=function(e){return this===e||null!=e&&(!!e.isA("Ray")&&(this.start.equals(e.start)&&t.floatsEqual(this.angle,e.angle)))},c.fromObject=function(t){return new c(n.fromObject(t.p1),n.fromObject(t.p2))},c.prototype=Object.create(o),c.prototype.isA=function(t){return"Segment"===t||"AbstractLine"===t},c.prototype.getSlope=function(){return t.floatsEqual(this.p1.x,this.p2.x)?1/0:(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)},c.prototype.getIntercept=function(){var t=this.getSlope();return Number.isFinite(t)?this.p1.y-t*this.p1.x:this.p1.x},c.prototype.closestPoint=function(e){var n=0;t.floatsEqual(this.getSlope(),0)?n=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(n=-1/this.getSlope());var s=r.fromPointSlope(e,n),i=this.intersectLine(s);return i.length>0?i[0]:e.dist(this.p1)>e.dist(this.p2)?this.p2:this.p1},c.prototype.contains=function(e){var n=this.p1.x,s=this.p1.y,i=e.x,o=e.y,r=this.p2.x,a=this.p2.y,c=this.getSlope(),l=!Number.isFinite(c)&&t.floatsEqual(i,n)||t.floatsEqual(o-s,c*(i-n));return l=l&&t.isBetween(i,n,r)&&t.isBetween(o,s,a)},c.prototype.startPoint=function(){return this.p1},c.prototype.angleAtStart=function(){return this.p1.angle(this.p2)},c.prototype.angleAtPoint=function(t){return this.angleAtStart()},c.prototype.canSwitchSides=function(){return!0},c.prototype.distance=function(t){return this.closestPoint(t).dist(t)},c.prototype.distanceAlong=function(t){var e=t.startPoint();return this.p1.dist(e)},c.prototype.divide=function(t){return this.contains(t)||(t=this.closestPoint(t)),this.p1.equals(t)?[new c(t,this.p2)]:this.p2.equals(t)?[new c(t,this.p1)]:[new c(t,this.p1),new c(t,this.p2)]},c.prototype.shortened=function(t){return new c(this.startPoint(),t.startPoint())},c.prototype.sameDirection=function(t){return!!t.isA("Segment")&&(this.p1.equals(t.p1)&&this.p2.equals(t.p2))},c.prototype.isIn=function(t){return t.contains(this.p1)&&t.contains(this.p2)},c.prototype.draw=function(t,e){var n=e.abstractToScreenCoord(this.p1),s=e.abstractToScreenCoord(this.p2);t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(s.x,s.y),t.stroke()},c.prototype.equals=function(t){return this===t||null!=t&&(!!t.isA("Segment")&&(this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)))},l.fromObject=function(t){return new l(n.fromObject(t.center),t.radius)},l.prototype=Object.create(i),l.prototype.isA=function(t){return"Circle"===t},l.prototype.contains=function(e){return t.floatsEqual(e.dist(this.center),this.radius)},l.prototype.getPointAtAngle=function(t){return new n(this.center.x+this.radius*Math.cos(t),this.center.y+this.radius*Math.sin(t))},l.prototype.intersectLine=function(t){return t.intersectCircle(this)},l.prototype.intersectCircle=function(e){var n,s=this.radius,i=e.radius,o=this.center.dist(e.center),r=this.center.angle(e.center);if(this.center.equals(e.center))return[];if(t.floatsEqual(o,s+i))return n=this.center.translate(s*Math.cos(r),s*Math.sin(r)),this.contains(n)&&e.contains(n)?[n]:[];if(t.floatsEqual(o,Math.abs(s-i)))return n=this.center.translate(s*Math.cos(r),s*Math.sin(r)),s<i&&(n=this.center.translate(s*Math.cos(t.oppositeAngle(r)),s*Math.sin(t.oppositeAngle(r)))),this.contains(n)&&e.contains(n)?[n]:[];if(o>s+i||o<Math.abs(s-i))return[];var a=[],c=Math.acos((Math.pow(s,2)+Math.pow(o,2)-Math.pow(i,2))/(2*s*o));return n=this.center.translate(s*Math.cos(r+c),s*Math.sin(r+c)),this.contains(n)&&e.contains(n)&&a.push(n),n=this.center.translate(s*Math.cos(r-c),s*Math.sin(r-c)),this.contains(n)&&e.contains(n)&&a.push(n),a},l.prototype.canSwitchSides=function(){return!1},l.prototype.distance=function(t){return Math.abs(this.center.dist(t)-this.radius)},l.prototype.curvature=function(){return 1/this.radius},l.prototype.closestPoint=function(t){var e=this.center.angle(t);return this.getPointAtAngle(e)},l.prototype.divide=function(t){this.contains(t)||(t=this.closestPoint(t));var e=this.center.angle(t),n=[];return n.push(new h(this.center,this.radius,e,2*Math.PI,!1)),n.push(new h(this.center,this.radius,e,2*Math.PI,!0)),n},l.prototype.draw=function(t,e){var n=e.abstractToScreenCoord(this.center),s=e.abstractToScreenDist(this.radius);t.beginPath(),t.arc(n.x,n.y,s,0,2*Math.PI),t.stroke()},l.prototype.same=function(e){return this.center.equals(e.center)&&t.floatsEqual(this.radius,e.radius)},l.prototype.equals=function(t){return this===t||null!=t&&(!(!t.isA("Circle")||t.isA("Arc"))&&this.same(t))},h.fromObject=function(t){return new h(n.fromObject(t.center),t.radius,t.start,t.sweep,t.inverse)},h.fromThreePoints=function(e,n,s){var i=e,o=e.dist(n),r=e.angle(n);return new h(i,o,r,t.angleDifference(e.angle(s),r))},h.prototype=Object.create(l.prototype),h.prototype.isA=function(t){return"Arc"===t||"Circle"===t},h.prototype.getEnd=function(){return t.angleSum(this.start,this.sweep)},h.prototype.contains=function(e){var n=this.center.dist(e);if(!t.floatsEqual(n,this.radius))return!1;var s=this.center.angle(e);return t.angleDifference(s,this.start)<this.sweep||t.floatsEqual(s,this.start)||t.floatsEqual(s,this.getEnd())},h.prototype.angleAtPoint=function(e){return this.inverse?t.angleDifference(this.center.angle(e),Math.PI/2):t.angleSum(this.center.angle(e),Math.PI/2)},h.prototype.startPoint=function(){return this.inverse?this.getPointAtAngle(this.getEnd()):this.getPointAtAngle(this.start)},h.prototype.angleAtStart=function(){return this.angleAtPoint(this.startPoint())},h.prototype.curvature=function(){var t=1/this.radius;return this.inverse&&(t*=-1),t},h.prototype.canSwitchSides=function(){return!t.floatsEqual(this.sweep,2*Math.PI)},h.prototype.distance=function(t){return this.closestPoint(t).dist(t)},h.prototype.closestPoint=function(t){var e=this.center.angle(t),n=this.getPointAtAngle(e);if(this.contains(n))return n;var s=this.getPointAtAngle(this.start),i=this.getPointAtAngle(this.getEnd());return t.dist(s)<t.dist(i)?s:i},h.prototype.distanceAlong=function(e){var n=e.startPoint(),s=this.center.angle(n),i=t.angleDifference(s,this.start);return this.inverse&&(i=t.angleDifference(this.getEnd(),s)),i},h.prototype.divide=function(e){this.contains(e)||(e=this.closestPoint(e));var n=this.center.angle(e);if(t.floatsEqual(n,this.start))return[new h(this.center,this.radius,this.start,this.sweep,!1)];if(t.floatsEqual(n,this.getEnd()))return[new h(this.center,this.radius,this.start,this.sweep,!0)];var s=[];return s.push(new h(this.center,this.radius,n,t.angleDifference(this.getEnd(),n),!1)),s.push(new h(this.center,this.radius,this.start,t.angleDifference(n,this.start),!0)),s},h.prototype.shortened=function(e){var n=this.start,s=this.center.angle(e.startPoint());this.inverse&&(n=this.center.angle(e.startPoint()),s=this.getEnd());var i=t.angleDifference(s,n);return t.floatsEqual(i,0)&&(i=2*Math.PI),new h(this.center,this.radius,n,i,this.inverse)},h.prototype.sameDirection=function(t){return!!t.isA("Arc")&&(this.equals(t)&&this.inverse===t.inverse)},h.prototype.isIn=function(e){var n=t.angleDifference(this.start,e.start)<=e.sweep,s=this.sweep<t.angleDifference(e.getEnd(),this.start);return n&&s},h.prototype.draw=function(e,n){var s=n.abstractToScreenCoord(this.center),i=n.abstractToScreenDist(this.radius),o=t.angleSum(this.start,n.angle),r=t.angleSum(this.getEnd(),n.angle);e.beginPath(),e.arc(s.x,s.y,i,o,r),e.stroke()},h.prototype.equals=function(e){return this===e||null!=e&&(!!e.isA("Arc")&&(this.center.equals(e.center)&&t.floatsEqual(this.radius,e.radius)&&t.floatsEqual(this.start,e.start)&&t.floatsEqual(this.sweep,e.sweep)))},u.fromObject=function(t){for(var e=[],n=t.path.length,s=0;s<n;s++){var i=t.path[s];void 0!==i.p1?e.push(c.fromObject(i)):void 0!==i.sweep?e.push(h.fromObject(i)):console.log("This should never happen (Enclosure.fromObject)")}return new u(e,t.color)},u.findEnclosure=function(e,n){var s,i,o,r,a=null,c=n.getPathables();for(c.sort(function(n,s){var i=n.distance(e),o=s.distance(e);if(t.floatsEqual(i,o)){if(n.isA("Circle")&&s.isA("Circle")){var r=n.center.dist(e),a=s.center.dist(e);return t.floatsEqual(r,a)?0:r<a?-1:1}return 0}return i<o?-1:1}),o=c.length,s=0;s<o;s++){var l=c[s],h=l.divide(l.closestPoint(e));for(r=h.length,i=0;i<r;i++){var p=h[i].comparePointTo(e);if(null!==(a=u.findEnclosureRecurse(e,[],h[i],p,n))&&a.contains(e))return a}}return null},u.findEnclosureRecurse=function(e,n,s,i,o){var r,a,c=null,l=s.getIntersectionsInOrder(i,o);for(a=l.length,r=0;r<a;r++){c=n.slice(0);var h=l[r],p=s.shortened(h),f=t.arrayIndexOf(c,p);if(f!==t.arrayLastIndexOf(c,p)||t.arrayContains(c,p)&&p.sameDirection(c[f]))return new u(c=c.slice(f));c.push(p);var d=u.findEnclosureRecurse(e,c,h,i,o);if(null!==d)return d}return null},u.prototype.contains=function(t){for(var e=new a(t,0),n=new a(t,Math.PI),s=0,i=0,o=0;o<this.path.length;o++){var r=this.path[o],c=e.intersect(r);s+=c.length,i+=(c=n.intersect(r)).length}return s%2==i%2&&s%2!=0},u.prototype.draw=function(e,n){e.fillStyle=this.color,e.beginPath();var s=n.abstractToScreenCoord(this.path[0].startPoint());e.moveTo(s.x,s.y);for(var i=0;i<this.path.length;i++){var o=this.path[i];if(o.isA("Segment"))s=n.abstractToScreenCoord(o.p2),e.lineTo(s.x,s.y);else if(o.isA("Arc")){s=n.abstractToScreenCoord(o.center);var r=n.abstractToScreenDist(o.radius),a=t.angleSum(o.start,n.angle),c=t.angleSum(o.getEnd(),n.angle);t.floatsEqual(o.sweep,2*Math.PI)&&(c=o.start+2*Math.PI),o.inverse?e.arc(s.x,s.y,r,c,a,!0):e.arc(s.x,s.y,r,a,c,!1)}else console.log("Enclosure.draw invalid enclosure"),console.log(this.path),console.log(o)}e.closePath(),e.fill()},p.prototype.setValues=function(t){void 0!==t.cX&&(this.cX=t.cX),void 0!==t.cY&&(this.cY=t.cY),void 0!==t.conversionRatio&&(this.conversionRatio=t.conversionRatio),void 0!==t.angle&&(this.angle=t.angle)},p.prototype.getAbstractBoundaries=function(){var t=this.screenToAbstractCoord(new n(0,0)),e=this.screenToAbstractCoord(new n(this.width,0)),s=this.screenToAbstractCoord(new n(this.width,this.height)),i=this.screenToAbstractCoord(new n(0,this.height)),o=[];return o.push(new c(t,e)),o.push(new c(e,s)),o.push(new c(s,i)),o.push(new c(i,t)),o},p.prototype.zoomIn=function(t,e){this.conversionRatio=this.conversionRatio*this.zoomAmt;var s=this.screenToAbstractCoord(new n(t,e)),i=new n(this.cX,this.cY).angle(s),o=new n(this.cX,this.cY).dist(s);this.cX+=(this.zoomAmt-1)*o*Math.cos(i),this.cY+=(this.zoomAmt-1)*o*Math.sin(i)},p.prototype.zoomOut=function(t,e){var s=this.screenToAbstractCoord(new n(t,e)),i=new n(this.cX,this.cY).angle(s),o=new n(this.cX,this.cY).dist(s);this.cX-=(this.zoomAmt-1)*o*Math.cos(i),this.cY-=(this.zoomAmt-1)*o*Math.sin(i),this.conversionRatio=this.conversionRatio/this.zoomAmt},p.prototype.translate=function(t,e){var n=this.screenToAbstractCoord(e),s=n.x-t.x,i=n.y-t.y;this.cX=this.cX-s,this.cY=this.cY-i},p.prototype.zoom=function(e,n,s,i,o){var r=e.dist(n),a=s.dist(i);if(!o){var c=e.angle(n),l=s.angle(i);this.angle=t.angleDifference(l,c)}this.conversionRatio=a/r,this.translate(e,s)},p.prototype.autoZoom=function(t){var e,s,i,o,r,a,c,l,h,u,p;function f(t){t.x<e&&(e=t.x),t.x>s&&(s=t.x),t.y<i&&(i=t.y),t.y>o&&(o=t.y)}for(c=t.points[0].rotateAroundOrigin(this.angle),e=s=c.x,i=o=c.y,a=t.points.length,r=1;r<a;r++)f(c=t.points[r].rotateAroundOrigin(this.angle));for(a=t.arcs.length,r=0;r<a;r++)l=(c=(h=(u=t.arcs[r]).center.rotateAroundOrigin(this.angle)).translate(-u.radius,0)).rotateAroundOrigin(-this.angle),u.contains(l)&&f(c),l=(c=h.translate(u.radius,0)).rotateAroundOrigin(-this.angle),u.contains(l)&&f(c),l=(c=h.translate(0,-u.radius)).rotateAroundOrigin(-this.angle),u.contains(l)&&f(c),l=(c=h.translate(0,u.radius)).rotateAroundOrigin(-this.angle),u.contains(l)&&f(c);for(a=t.circles.length,r=0;r<a;r++)f(c=(h=(p=t.circles[r]).center.rotateAroundOrigin(this.angle)).translate(-p.radius,0)),f(c=h.translate(p.radius,0)),f(c=h.translate(0,-p.radius)),f(c=h.translate(0,p.radius));this.conversionRatio=Math.min((this.width-2)/(s-e),(this.height-2)/(o-i)),c=(c=new n((s+e)/2,(o+i)/2)).rotateAroundOrigin(-this.angle),this.cX=c.x,this.cY=c.y},p.prototype.abstractToScreenDist=function(t){return t*this.conversionRatio},p.prototype.screenToAbstractDist=function(t){return t/this.conversionRatio},p.prototype.abstractToScreenCoord=function(t){var e=new n((t.x-this.cX)*this.conversionRatio,(t.y-this.cY)*this.conversionRatio);return(e=e.rotateAroundOrigin(this.angle)).x=e.x+this.width/2,e.y=e.y+this.height/2,e},p.prototype.screenToAbstractCoord=function(t){var e=new n(t.x-this.width/2,t.y-this.height/2);return(e=e.rotateAroundOrigin(-this.angle)).x=e.x/this.conversionRatio+this.cX,e.y=e.y/this.conversionRatio+this.cY,e},p.prototype.copy=function(){var t=new p;return t.cX=this.cX,t.cY=this.cY,t.conversionRatio=this.conversionRatio,t.anlge=this.angle,t.height=this.height,t.width=this.width,t},p.prototype.toJSON=function(){return{cX:this.cX,cY:this.cY,conversionRatio:this.conversionRatio,angle:this.angle,height:this.height,width:this.width}},f.fromObject=function(t){var e,s,i=new f;for(s=t.enclosures.length,e=0;e<s;e++)i.enclosures.push(u.fromObject(t.enclosures[e]));for(s=t.segments.length,e=0;e<s;e++)i.segments.push(c.fromObject(t.segments[e]));for(s=t.rays.length,e=0;e<s;e++)i.rays.push(a.fromObject(t.rays[e]));for(s=t.lines.length,e=0;e<s;e++)i.lines.push(r.fromObject(t.lines[e]));for(s=t.arcs.length,e=0;e<s;e++)i.arcs.push(h.fromObject(t.arcs[e]));for(s=t.circles.length,e=0;e<s;e++)i.circles.push(l.fromObject(t.circles[e]));for(s=t.points.length,e=0;e<s;e++)i.points.push(n.fromObject(t.points[e]));return i},f.prototype.start=function(){var t;for(this.circles.push(new l(new n(0,0),1)),this.points.push(new n(0,0)),t=0;t<6;t++)this.points.push(new n(1*Math.cos(t*Math.PI/3),1*Math.sin(t*Math.PI/3)))},f.prototype.getTopEnclosure=function(t){for(var e=this.enclosures.length-1;e>=0;e--)if(this.enclosures[e].contains(t))return this.enclosures[e];return null},f.prototype.getPathables=function(){var t=this.segments.concat(this.rays);return t=(t=(t=t.concat(this.lines)).concat(this.arcs)).concat(this.circles)},f.prototype.nearestPoint=function(t){for(var e=this.points[0],n=t.dist(e),s=this.points.length,i=1;i<s;i++){var o=this.points[i];t.dist(o)<n&&(e=o,n=t.dist(e))}return e},f.prototype.addEnclosure=function(t){this.enclosures.push(t)},f.prototype.addAllIntersections=function(t){var e,n;for(n=this.segments.length,e=0;e<n;e++)this.addPoints(t.intersectLine(this.segments[e]));for(n=this.rays.length,e=0;e<n;e++)this.addPoints(t.intersectLine(this.rays[e]));for(n=this.lines.length,e=0;e<n;e++)this.addPoints(t.intersectLine(this.lines[e]));for(n=this.arcs.length,e=0;e<n;e++)this.addPoints(t.intersectCircle(this.arcs[e]));for(n=this.circles.length,e=0;e<n;e++)this.addPoints(t.intersectCircle(this.circles[e]))},f.prototype.addSegmentWithIntersections=function(t){this.addAllIntersections(t),this.addSegmentWithoutIntersections(t)},f.prototype.addSegmentWithoutIntersections=function(t){var e,n;for(n=this.lines.length,e=0;e<n;e++)if(t.same(this.lines[e]))return;for(n=this.rays.length,e=0;e<n;e++){var s=this.rays[e];if(t.same(s)){if(s.contains(t.p1)&&s.contains(t.p2))return;if(s.contains(t.p1))return this.rays.splice(e,1),void this.addRayWithoutIntersections(new a(t.p2,s.angle));if(s.contains(t.p2))return this.rays.splice(e,1),void this.addRayWithoutIntersections(new a(t.p1,s.angle))}}for(n=this.segments.length,e=0;e<n;e++){var i=this.segments[e];if(t.same(i)){if(t.isIn(i))return;i.isIn(t)?(this.segments.splice(e,1),e--,n--):t.contains(i.p1)&&i.contains(t.p1)?(t=new c(t.p2,i.p2),this.segments.splice(e,1),e--,n--):t.contains(i.p1)&&i.contains(t.p2)?(t=new c(t.p1,i.p2),this.segments.splice(e,1),e--,n--):t.contains(i.p2)&&i.contains(t.p1)?(t=new c(t.p2,i.p1),this.segments.splice(e,1),e--,n--):t.contains(i.p2)&&i.contains(t.p2)&&(t=new c(t.p1,i.p1),this.segments.splice(e,1),e--,n--)}}this.segments.push(t)},f.prototype.addRayWithIntersections=function(t){this.addAllIntersections(t),this.addRayWithoutIntersections(t)},f.prototype.addRayWithoutIntersections=function(e){var n,s;for(s=this.lines.length,n=0;n<s;n++)if(e.same(this.lines[n]))return;for(s=this.rays.length,n=0;n<s;n++){var i=this.rays[n];if(e.same(i))if(t.floatsEqual(e.angle,i.angle)){if(!e.contains(i.start))return;this.rays.splice(n,1),n--,s--}else if(e.contains(i.start))return this.rays.splice(n,1),void this.addLineWithoutIntersections(new r(e.getSlope(),e.getIntercept()))}for(s=this.segments.length,n=0;n<s;n++){var o=this.segments[n];e.same(o)&&(e.contains(o.p1)&&e.contains(o.p2)?(this.segments.splice(n,1),n--,s--):e.contains(o.p1)?(e=new a(o.p2,e.angle),this.segments.splice(n,1),n--,s--):e.contains(o.p2)&&(e=new a(o.p1,e.angle),this.segments.splice(n,1),n--,s--))}this.rays.push(e)},f.prototype.addLineWithIntersections=function(t){this.addAllIntersections(t),this.addLineWithoutIntersections(t)},f.prototype.addLineWithoutIntersections=function(t){var e,n;for(n=this.lines.length,e=0;e<n;e++)if(t.same(this.lines[e]))return;function s(e){return!t.same(e)}this.segments=this.segments.filter(s),this.rays=this.rays.filter(s),this.lines.push(t)},f.prototype.addArcWithIntersections=function(t){this.addAllIntersections(t),this.addArcWithoutIntersections(t)},f.prototype.addArcWithoutIntersections=function(e){var n,s;for(s=this.circles.length,n=0;n<s;n++)if(e.same(this.circles[n]))return;for(s=this.arcs.length,n=0;n<s;n++){var i=this.arcs[n];if(e.same(i)){if(e.isIn(i))return;if(i.isIn(e))this.arcs.splice(n,1),n--,s--;else{if(t.floatsEqual(e.start,i.getEnd())&&t.floatsEqual(e.getEnd(),i.start))return this.arcs.splice(n,1),void this.addCircleWithoutIntersections(new l(e.center,e.radius));if(t.floatsEqual(e.start,i.getEnd())&&t.angleDifference(e.getEnd(),i.start)<i.sweep)return this.arcs.splice(n,1),void this.addCircleWithoutIntersections(new l(e.center,e.radius));if(t.angleDifference(e.start,i.start)<i.sweep&&t.angleDifference(e.getEnd(),i.start)<i.sweep)return this.arcs.splice(n,1),void this.addCircleWithoutIntersections(new l(e.center,e.radius));t.angleDifference(e.start,i.start)<i.sweep?(this.arcs.splice(n,1),n--,s--,e=new h(e.center,e.radius,i.start,t.angleDifference(e.getEnd(),i.start))):t.angleDifference(e.getEnd(),i.start)<i.sweep&&(this.arcs.splice(n,1),n--,s--,e=new h(e.center,e.radius,e.start,t.angleDifference(i.getEnd(),e.start)))}}}this.arcs.push(e)},f.prototype.addCircleWithIntersections=function(t){this.addAllIntersections(t),this.addCircleWithoutIntersections(t)},f.prototype.addCircleWithoutIntersections=function(t){var e,n;for(n=this.circles.length,e=0;e<n;e++)if(t.same(this.circles[e]))return;this.arcs=this.arcs.filter(function(e){return!t.same(e)}),this.circles.push(t)},f.prototype.addPoint=function(t){this.points.push(t)},f.prototype.addPoints=function(e){for(var n=e.length,s=0;s<n;s++)t.arrayContains(this.points,e[s])||this.points.push(e[s])},f.prototype.removeEnclosure=function(t){var e,n;for(n=this.enclosures.length,e=0;e<n;e++)this.enclosures[e].contains(t)&&(this.enclosures.splice(e,1),e--,n--)},f.prototype.removeSegment=function(e){var n,s;for(s=this.segments.length,n=0;n<s;n++){var i=this.segments[n];if(e.same(i))if(e.equals(i)||i.isIn(e))this.segments.splice(n,1),n--,s--;else if(e.isIn(i)){var o=i.p1,r=i.p2,l=e.p1,h=e.p2;t.floatsEqual(o.x,r.x)?(r.y<o.y&&(o=i.p2,r=i.p1),h.y<l.y&&(l=e.p2,h=e.p1)):(r.x<o.x&&(o=i.p2,r=i.p1),h.x<l.x&&(l=e.p2,h=e.p1)),this.segments.splice(n,1),this.addSegmentWithoutIntersections(new c(o,l)),this.addSegmentWithoutIntersections(new c(h,r)),n--,s--}else e.contains(i.p1)?(this.segments.splice(n,1),i.contains(e.p1)?this.addSegmentWithoutIntersections(new c(e.p1,i.p2)):this.addSegmentWithoutIntersections(new c(e.p2,i.p2)),n--,s--):e.contains(i.p2)&&(this.segments.splice(n,1),i.contains(e.p1)?this.addSegmentWithoutIntersections(new c(e.p1,i.p1)):this.addSegmentWithoutIntersections(new c(e.p2,i.p1)),n--,s--)}for(s=this.rays.length,n=0;n<s;n++){var u=this.rays[n];if(e.same(u))if(u.contains(e.p1)&&u.contains(e.p2)){var p=new c(u.start,e.p1),f=e.p2;p.contains(e.p2)&&(p=new c(u.start,e.p2),f=e.p1),this.rays.splice(n,1),this.addRayWithoutIntersections(new a(f,u.angle)),p.p1.equals(p.p2)||this.addSegmentWithoutIntersections(p),n--,s--}else u.contains(e.p1)&&!u.start.equals(e.p1)?(this.rays.splice(n,1),this.addRayWithoutIntersections(new a(e.p1,u.angle)),n--,s--):u.contains(e.p2)&&!u.start.equals(e.p2)&&(this.rays.splice(n,1),this.addRayWithoutIntersections(new a(e.p2,u.angle)),n--,s--)}for(s=this.lines.length,n=0;n<s;n++){var d=this.lines[n];if(e.same(d)){var g=t.slopeToAngle(d.slope),v=t.oppositeAngle(g),w=new a(e.p1,g),m=new a(e.p2,v);(w.contains(e.p2)||m.contains(e.p1))&&(w=new a(e.p1,v),m=new a(e.p2,g)),this.lines.splice(n,1),this.addRayWithoutIntersections(w),this.addRayWithoutIntersections(m),n--,s--}}},f.prototype.removeRay=function(e){var n,s;for(s=this.segments.length,n=0;n<s;n++){var i=this.segments[n];e.same(i)&&(e.contains(i.p1)&&e.contains(i.p2)?(this.segments.splice(n,1),n--,s--):e.contains(i.p1)?(this.segments.splice(n,1),this.addSegmentWithoutIntersections(new c(i.p2,e.start)),n--,s--):e.contains(i.p2)&&(this.segments.splice(n,1),this.addSegmentWithoutIntersections(new c(i.p1,e.start)),n--,s--))}for(s=this.rays.length,n=0;n<s;n++){var o=this.rays[n];e.same(o)&&(t.floatsEqual(e.angle,o.angle)?e.contains(o.start)?(this.rays.splice(n,1),n--,s--):(this.rays.splice(n,1),this.addSegmentWithoutIntersections(new c(e.start,o.start)),n--,s--):e.contains(o.start)&&!e.start.equals(o.start)&&(this.rays.splice(n,1),this.addRayWithoutIntersections(new a(e.start,o.angle)),n--,s--))}for(s=this.lines.length,n=0;n<s;n++){var r=this.lines[n];e.same(r)&&(this.lines.splice(n,1),this.addRayWithoutIntersections(new a(e.start,t.oppositeAngle(e.angle))),n--,s--)}},f.prototype.removeLine=function(t){var e,n;for(n=this.segments.length,e=0;e<n;e++){var s=this.segments[e];t.same(s)&&(this.segments.splice(e,1),e--,n--)}for(n=this.rays.length,e=0;e<n;e++){var i=this.rays[e];t.same(i)&&(this.rays.splice(e,1),e--,n--)}for(n=this.lines.length,e=0;e<n;e++){var o=this.lines[e];t.same(o)&&(this.lines.splice(e,1),e--,n--)}},f.prototype.removeArc=function(e){var n,s;for(s=this.arcs.length,n=0;n<s;n++){var i=this.arcs[n];e.same(i)&&(e.equals(i)||i.isIn(e)?(this.arcs.splice(n,1),n--,s--):e.isIn(i)?(this.arcs.splice(n,1),t.floatsEqual(e.start,i.start)||this.addArcWithoutIntersections(new h(e.center,e.radius,i.start,t.angleDifference(e.start,i.start))),t.floatsEqual(i.getEnd(),e.getEnd())||this.addArcWithoutIntersections(new h(e.center,e.radius,e.getEnd(),t.angleDifference(i.getEnd(),e.getEnd()))),n--,s--):t.angleDifference(e.start,i.start)<i.sweep&&t.angleDifference(e.getEnd(),i.start)<i.sweep?(this.arcs.splice(n,1),this.addArcWithoutIntersections(new h(e.center,e.radius,e.getEnd(),t.angleDifference(e.start,e.getEnd()))),n--,s--):t.angleDifference(e.start,i.start)<i.sweep?(this.arcs.splice(n,1),this.addArcWithoutIntersections(new h(e.center,e.radius,i.start,t.angleDifference(e.start,i.start))),n--,s--):t.angleDifference(e.getEnd(),i.start)<i.sweep&&(this.arcs.splice(n,1),this.addArcWithoutIntersections(new h(e.center,e.radius,e.getEnd(),t.angleDifference(i.getEnd(),e.getEnd()))),n--,s--))}for(s=this.circles.length,n=0;n<s;n++){var o=this.circles[n];e.same(o)&&(this.circles.splice(n,1),this.addArcWithoutIntersections(new h(e.center,e.radius,e.getEnd(),t.angleDifference(2*Math.PI,e.sweep))),n--,s--)}},f.prototype.removeCircle=function(t){var e,n;for(n=this.arcs.length,e=0;e<n;e++){var s=this.arcs[e];t.same(s)&&(this.arcs.splice(e,1),e--,n--)}for(n=this.circles.length,e=0;e<n;e++){var i=this.circles[e];t.same(i)&&(this.circles.splice(e,1),e--,n--)}},f.prototype.removePoint=function(t){var e,n;for(n=this.points.length,e=0;e<n;e++)t.equals(this.points[e])&&(this.points.splice(e,1),e--,n--)},f.prototype.copy=function(){var t=new f;return t.enclosures=this.enclosures.slice(0),t.segments=this.segments.slice(0),t.rays=this.rays.slice(0),t.lines=this.lines.slice(0),t.arcs=this.arcs.slice(0),t.circles=this.circles.slice(0),t.points=this.points.slice(0),t},f.prototype.draw=function(t,e,n,s){var i,o;for(o=this.enclosures.length,i=0;i<o;i++)this.enclosures[i].draw(t,e);if(n){for(o=this.segments.length,i=0;i<o;i++)this.segments[i].draw(t,e);for(o=this.rays.length,i=0;i<o;i++)this.rays[i].draw(t,e);for(o=this.lines.length,i=0;i<o;i++)this.lines[i].draw(t,e);for(o=this.arcs.length,i=0;i<o;i++)this.arcs[i].draw(t,e);for(o=this.circles.length,i=0;i<o;i++)this.circles[i].draw(t,e)}if(s)for(o=this.points.length,i=0;i<o;i++)this.points[i].draw(t,e)},f.prototype.toJSON=function(){return{enclosures:this.enclosures,segments:this.segments,rays:this.rays,lines:this.lines,arcs:this.arcs,circles:this.circles,points:this.points}};var d=[];function g(t,e){this.name=t,this.pointsNeeded=e}g.prototype.shadowHook1=function(t){return[]},g.prototype.shadowHook2=function(t,e){return this.shadowHook1(t)},g.prototype.shadowHook3=function(t,e,n){return this.shadowHook2(t,e)},g.prototype.press=function(t,e){var s;s=new n(t,e),function(t){for(var e=!0,n=V.length,s=0;s<n;s++)if(t.equals(V[s])){e=!1;break}e&&V.push(t),tt()}(X.nearestPoint(F.screenToAbstractCoord(s))),V.length===this.pointsNeeded&&(_=[],this.endHook(),V=[])},g.prototype.release=function(t,e){1===V.length&&this.press(t,e)},g.prototype.click=function(t,e){this.release(t,e)},g.prototype.drag=function(t,e){var s,i,o,r=(s=new n(t,e),i=F.screenToAbstractCoord(s),o=X.nearestPoint(i),F.abstractToScreenDist(i.dist(o))<20?o:i);0===V.length?_=this.shadowHook1(r):1===V.length?_=this.shadowHook2(V[0],r):2===V.length&&(_=this.shadowHook3(V[0],V[1],r)),tt()};var v=new g("Draw Segment",2);v.shadowHook2=function(t,e){return[new c(t,e)]},v.endHook=function(){U(function(t){t.addSegmentWithIntersections(new c(V[0],V[1]))})},d.push(v);var w=new g("Draw Ray",2);w.shadowHook2=function(t,e){return[a.fromTwoPoints(t,e)]},w.endHook=function(){U(function(t){t.addRayWithIntersections(a.fromTwoPoints(V[0],V[1]))})},d.push(w);var m=new g("Draw Line",2);m.shadowHook2=function(t,e){return[r.fromTwoPoints(t,e)]},m.endHook=function(){U(function(t){t.addLineWithIntersections(r.fromTwoPoints(V[0],V[1]))})},d.push(m);var y=new g("Draw Arc",3);y.shadowHook2=function(t,e){return[new l(t,t.dist(e))]},y.shadowHook3=function(t,e,n){return[h.fromThreePoints(t,e,n)]},y.endHook=function(){U(function(t){t.addArcWithIntersections(h.fromThreePoints(V[0],V[1],V[2]))})},d.push(y);var P=new g("Draw Circle",2);P.shadowHook2=function(t,e){return[new l(t,t.dist(e))]},P.endHook=function(){U(function(t){t.addCircleWithIntersections(new l(V[0],V[0].dist(V[1])))})},d.push(P);var I=new g("Erase Segment",2);I.shadowHook2=v.shadowHook2,I.endHook=function(){U(function(t){t.removeSegment(new c(V[0],V[1]))})},d.push(I);var A=new g("Erase Ray",2);A.shadowHook2=w.shadowHook2,A.endHook=function(){U(function(t){t.removeRay(a.fromTwoPoints(V[0],V[1]))})},d.push(A);var b=new g("Erase Line",2);b.shadowHook2=m.shadowHook2,b.endHook=function(){U(function(t){t.removeLine(r.fromTwoPoints(V[0],V[1]))})},d.push(b);var S=new g("Erase Arc",3);S.shadowHook2=y.shadowHook2,S.shadowHook3=y.shadowHook3,S.endHook=function(){U(function(t){t.removeArc(h.fromThreePoints(V[0],V[1],V[2]))})},d.push(S);var E=new g("Erase Circle",2);E.shadowHook2=P.shadowHook2,E.endHook=function(){U(function(t){t.removeCircle(new l(V[0],V[0].dist(V[1])))})},d.push(E);var M=new g("Erase Point",1);M.shadowHook1=function(t){return[t]},M.endHook=function(){U(function(t){t.removePoint(V[0])})},d.push(M);var T=new g("Midpoint",2);T.shadowHook2=function(e,n){return[t.midPoint(e,n)]},T.endHook=function(){U(function(e){e.addPoint(t.midPoint(V[0],V[1]))})},d.push(T);var x=new g("Trisect",2);x.calculatePoints=function(t,e){var s=e.x-t.x,i=e.y-t.y,o=t.x+s/3,r=t.y+i/3,a=t.x+2*s/3,c=t.y+2*i/3;return[new n(o,r),new n(a,c)]},x.shadowHook2=function(t,e){return this.calculatePoints(t,e)},x.endHook=function(){var t=this.calculatePoints(V[0],V[1]);U(function(e){e.addPoints(t)})},d.push(x);var C=new g("Perpendicular Bisector",2);C.calculateLine=function(e,n){var s=t.midPoint(e,n),i=r.fromTwoPoints(e,n).getSlope();return r.fromPointSlope(s,t.perpendicularSlope(i))},C.shadowHook2=function(e,n){return[this.calculateLine(e,n),t.midPoint(e,n)]},C.endHook=function(){var e=this.calculateLine(V[0],V[1]);U(function(n){n.addPoint(t.midPoint(V[0],V[1])),n.addLineWithIntersections(e)})},d.push(C);var q=new g("Angle Bisector",3);q.calculateLine=function(e,n,s){var i=(n.angle(e)+n.angle(s))/2,o=t.angleToSlope(i);return r.fromPointSlope(n,o)},q.shadowHook2=function(t,e){return[r.fromTwoPoints(t,e)]},q.shadowHook3=function(t,e,n){return[this.calculateLine(t,e,n)]},q.endHook=function(){var t=this.calculateLine(V[0],V[1],V[2]);U(function(e){e.addLineWithIntersections(t)})},d.push(q);var D=new g("Tangent Line",2);D.calculateLine=function(e,n){var s=r.fromTwoPoints(e,n).getSlope();return r.fromPointSlope(n,t.perpendicularSlope(s))},D.shadowHook2=function(t,e){return[this.calculateLine(t,e)]},D.endHook=function(){var t=this.calculateLine(V[0],V[1]);U(function(e){e.addLineWithIntersections(t)})},d.push(D);var k=new g("Parallel Line",3);k.calculateLine=function(t,e,n){var s=r.fromTwoPoints(t,e).getSlope();return r.fromPointSlope(n,s)},k.shadowHook2=function(t,e){return[r.fromTwoPoints(t,e)]},k.shadowHook3=function(t,e,n){return[this.calculateLine(t,e,n)]},k.endHook=function(){var t=this.calculateLine(V[0],V[1],V[2]);U(function(e){e.addLineWithIntersections(t)})},d.push(k);var H=new g("Circumscribe Triangle",3);H.calculateCenter=function(e,n,s){var i=r.fromTwoPoints(e,n);i=r.fromPointSlope(t.midPoint(e,n),t.perpendicularSlope(i.getSlope()));var o=r.fromTwoPoints(n,s);o=r.fromPointSlope(t.midPoint(n,s),t.perpendicularSlope(o.getSlope()));var a=i.intersectLine(o);return a.length>0?a[0]:null},H.shadowHook2=function(e,n){var s=t.midPoint(e,n),i=new l(s,s.dist(e));return[s,i]},H.shadowHook3=function(t,e,n){var s=this.calculateCenter(t,e,n);if(null===s)return[];var i=new l(s,s.dist(t));return[s,i]},H.calculateCircle=function(t,e,n){var s=this.calculateCenter(t,e,n);return null===s?null:new l(s,s.dist(t))},H.endHook=function(){var t=this.calculateCenter(V[0],V[1],V[2]);if(null!==t){var e=this.calculateCircle(V[0],V[1],V[2]);U(function(n){n.addPoint(t),n.addCircleWithIntersections(e)})}},d.push(H);var O=new g("Compass",3);O.shadowHook2=function(t,e){return[new l(t,t.dist(e))]},O.shadowHook3=function(t,e,n){return[new l(n,t.dist(e))]},O.endHook=function(){U(function(t){t.addCircleWithIntersections(new l(V[2],V[0].dist(V[1])))})},d.push(O);var R=new g("Fill Color",0);R.press=function(){},R.release=function(t,e){var s=F.screenToAbstractCoord(new n(t,e)),i=u.findEnclosure(s,X);null!==i&&(i.color=G,U(function(t){t.addEnclosure(i)}))},R.click=function(){},R.drag=function(){},d.push(R);var W=new g("Erase Color",0);W.press=function(){},W.release=function(t,e){var s=F.screenToAbstractCoord(new n(t,e));U(function(t){t.removeEnclosure(s)})},W.click=function(){},W.drag=function(){},d.push(W);var L=new g("Pick Color",0);L.press=function(){},L.release=function(t,e){var s=F.screenToAbstractCoord(new n(t,e)),i=X.getTopEnclosure(s);null!==i&&(G=i.color,$("#chooseColor").val(i.color))},L.click=function(){},L.drag=function(){},d.push(L);var N=new g("Pan",0);N.oldPoint=null,N.press=function(t,e){this.oldPoint=F.screenToAbstractCoord(new n(t,e))},N.release=function(t,e){this.oldPoint=null},N.click=function(){},N.drag=function(t,e){if(null!==this.oldPoint){var s=F.screenToAbstractCoord(new n(t,e)),i=s.x-this.oldPoint.x,o=s.y-this.oldPoint.y;F.cX=F.cX-i,F.cY=F.cY-o,tt()}},d.push(N);var Y=new g("Rotate",0);Y.oldAngle=null,Y.press=function(t,e){var s=new n(F.cX,F.cY);this.oldAngle=s.angle(F.screenToAbstractCoord(new n(t,e)))},Y.release=function(t,e){this.oldAngle=null},Y.click=function(){},Y.drag=function(e,s){if(null!==this.oldAngle){var i=new n(F.cX,F.cY).angle(F.screenToAbstractCoord(new n(e,s)))-this.oldAngle;F.angle=t.angleSum(F.angle,i),tt()}},d.push(Y);var j={multiTouchMode:!1,abstractPoints:[],touchStart:function(t){this.multiTouchMode||(V=[],_=[],this.multiTouchMode=!0),this.abstractPoints=[];for(var e=0;e<t.length;e++){var s=new n(t[e].x,t[e].y);this.abstractPoints.push(F.screenToAbstractCoord(s))}},touchMove:function(t){for(var e=[],s=0;s<t.length;s++){var i=new n(t[s].x,t[s].y);e.push(i)}this.abstractPoints.length>1&&e.length>1?F.zoom(this.abstractPoints[0],this.abstractPoints[1],e[0],e[1],!1):F.translate(this.abstractPoints[0],e[0]),tt()},touchEnd:function(t){this.abstractPoints=[];for(var e=0;e<t.length;e++){var s=new n(t[e].x,t[e].y);this.abstractPoints.push(F.screenToAbstractCoord(s))}0===t.length&&(this.multiTouchMode=!1)}};var X=new f,F=new p;X.start();var z,B=P,V=[],_=[],G="#ff0000",J=!0,K=!0,Z={};function U(t){var e=X.copy();t(e),Q(e),V=[],tt()}function Q(t){X.next=t,t.previous=X,X=t,ot("autosave",!1)}function tt(){z.clearRect(0,0,z.canvas.width,z.canvas.height),z.fillStyle="#fafafa",z.fillRect(0,0,z.canvas.width,z.canvas.height),z.strokeStyle="black",X.draw(z,F,J,K);for(var n=V.length,s=0;s<n;s++)V[s].draw(z,F,new e(255,0,0));for(z.strokeStyle="lightgray",n=_.length,s=0;s<n;s++)_[s].draw(z,F,new e(190,190,190));$("#angle").val(t.round(t.toDegrees(F.angle),-6))}function et(){F.conversionRatio=Math.min(F.width,F.height)/2-1,F.cX=0,F.cY=0,F.angle=0,tt()}null!==localStorage.getItem("saves")&&(Z=JSON.parse(localStorage.getItem("saves")));var nt=!1;function st(){if(!nt){var t=document.getElementById("saveDialogContents");for(var e in Z){var n=Z[e],s=document.createElement("input");s.id="saveDialogInput"+e,s.value=e,s.className="saveDialogRadio",s.setAttribute("type","radio"),s.setAttribute("name","saveDialogRadio"),s.onclick=function(){document.getElementById("saveFilename").value=this.value};var i=document.createElement("label");i.setAttribute("for","saveDialogInput"+e);var o=document.createElement("div");o.innerHTML=e;var r=document.createElement("canvas");r.height=100,r.width=100;var a=r.getContext("2d"),c=new p;c.height=100,c.width=100,c.setValues(n.converter),c.conversionRatio=100*c.conversionRatio/Math.min(n.converter.height,n.converter.width),f.fromObject(n.state).draw(a,c,!0,!1),i.appendChild(o),i.appendChild(r),t.appendChild(s),t.appendChild(i)}$(".saveDialogRadio").checkboxradio({icon:!1}),nt=!0}}function it(){nt=!1;var t=document.getElementById("saveDialogContents"),e=t.cloneNode(!1);t.parentNode.replaceChild(e,t)}function ot(t,e){var n={state:X,converter:F.copy()};e&&void 0!==Z[t]&&!confirm("Are you sure you want to overwrite "+t+"?")||(Z[t]=n,localStorage.setItem("saves",JSON.stringify(Z)),$("#saveDialog").dialog("close"),it())}return{converter:F,getCurrentState:function(){return X},getInputStrategy:function(){return B},setInputStrategy:function(t){V=[],_=[];for(var e=d.length,n=0;n<e;n++)d[n].name===t&&(B=d[n]);tt()},multiTouchHandler:j,setColor:function(t){G=t},setContext:function(t){z=t},getContext:function(){return z},initContext:function(){z.lineWidth=2},resizeCanvas:function(){var t=document.getElementById("myCanvas");t.width=0,t.height=0,t.width=$("#viewport").width(),t.height=$("#viewport").height(),F.width=t.width,F.height=t.height},updateView:tt,clear:function(){var t=new f;t.start(),Q(t),V=[],et()},undo:function(){V=[],null!==X.previous&&(X=X.previous,tt())},redo:function(){V=[],null!==X.next&&(X=X.next,tt())},autoZoom:function(){F.autoZoom(X),tt()},setDefaultView:et,zoomIn:function(){F.conversionRatio=F.conversionRatio*F.zoomAmt,tt()},zoomOut:function(){F.conversionRatio=F.conversionRatio/F.zoomAmt,tt()},setAngle:function(e){var n=Number(e);NaN!==n&&(F.angle=t.toRadians(n)),tt()},setShowLines:function(t){J=t,tt()},setShowPoints:function(t){K=t,tt()},generateSaveDialog:st,save:ot,load:function(t){var e=Z[t];void 0===e?alert("There is no save named "+t+"."):(F.setValues(e.converter),Q(f.fromObject(e.state)),tt(),$("#saveDialog").dialog("close"))},deleteSave:function(t){confirm("Are you sure you want to delete "+t+"?")&&(delete Z[t],localStorage.setItem("saves",JSON.stringify(Z)),it(),st())},saveAsPNG:function(t){var e=document.getElementById("myCanvas"),n=document.createElement("canvas");n.width=e.width,n.height=e.height;var s=n.getContext("2d");s.lineWidth=2,X.draw(s,F,J,!1);var i=n.toDataURL("image/png"),o=document.createElement("a");""===t?t="aldraw.png":t.endsWith(".png")||(t+=".png"),o.download=t,o.href=i,o.click()},saveAsSVG:function(e){function n(t){var e=F.abstractToScreenCoord(t.p1),n=F.abstractToScreenCoord(t.p2);return'<line x1="'+e.x+'" y1="'+e.y+'" x2="'+n.x+'" y2="'+n.y+'" style="stroke:#000000;"/>'}for(var s,i,o,r,a='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+F.width+'px" height="'+F.height+'px">',c=X.enclosures.length,l=0;l<c;l++){var h=X.enclosures[l],u=F.abstractToScreenCoord(h.path[0].startPoint());a+='<path d="M '+u.x+" "+u.y;for(var p=0;p<h.path.length;p++){var f=h.path[p];if(f.isA("Segment"))a+=" L "+(u=F.abstractToScreenCoord(f.p2)).x+" "+u.y;else if(t.floatsEqual(f.sweep,2*Math.PI)){var d=F.abstractToScreenCoord(f.getPointAtAngle(t.angleSum(f.start,Math.PI)));i=F.abstractToScreenCoord(f.getPointAtAngle(f.start)),s=F.abstractToScreenDist(f.radius),r=1,f.inverse&&(r=0),a+=" A "+s+" "+s+" 0 0 "+r+" "+d.x+" "+d.y,a+=" A "+s+" "+s+" 0 1 "+r+" "+i.x+" "+i.y}else i=F.abstractToScreenCoord(f.getPointAtAngle(f.getEnd())),s=F.abstractToScreenDist(f.radius),o=0,f.sweep>Math.PI&&(o=1),r=1,f.inverse&&(i=F.abstractToScreenCoord(f.getPointAtAngle(f.start)),r=0),a+=" A "+s+" "+s+" 0 "+o+" "+r+" "+i.x+" "+i.y}a+='" fill="'+h.color+'" fill-rule="evenodd" stroke="none"/>'}for(c=X.segments.length,l=0;l<c;l++){var g=X.segments[l];a+=n(g)}for(c=X.rays.length,l=0;l<c;l++)null!==(g=X.rays[l].getPortionInsideRectangle(F.getAbstractBoundaries()))&&(a+=n(g));for(c=X.lines.length,l=0;l<c;l++)null!==(g=X.lines[l].getPortionInsideRectangle(F.getAbstractBoundaries()))&&(a+=n(g));for(c=X.arcs.length,l=0;l<c;l++){var v=X.arcs[l],w=F.abstractToScreenCoord(v.getPointAtAngle(v.start));i=F.abstractToScreenCoord(v.getPointAtAngle(v.getEnd())),s=F.abstractToScreenDist(v.radius),o=0,v.sweep>Math.PI&&(o=1),a+='<path d="M'+w.x+" "+w.y+" A"+s+" "+s+" 0 "+o+" 1 "+i.x+" "+i.y+'" style="stroke:#000000; fill:none"/>'}for(c=X.circles.length,l=0;l<c;l++){var m=X.circles[l],y=F.abstractToScreenCoord(m.center);s=F.abstractToScreenDist(m.radius),a+='<circle cx="'+y.x+'" cy="'+y.y+'" r="'+s+'" style="stroke:#000000; fill:none"/>'}a+="</svg>";var P=new Blob([a]),I=window.URL.createObjectURL(P),A=document.createElement("a");""===e?e="aldraw.svg":e.endsWith(".svg")||(e+=".svg"),A.download=e,A.href=I,A.click()}}}();function clickModeGroup(t){$(".modeGroup").hide(),$("."+t).show(),AlDrawModule.setInputStrategy($('[name="'+t+'"]:checked').val())}function markChecked(t){document.getElementById(t).checked=!0,$(".relatedButtons").checkboxradio("refresh")}function nextHelpPage(){document.getElementById("helpContent").scrollTop=0;var t=$(".helpPage.visible"),e=t.next();t.removeClass("visible"),t.addClass("invisible"),e.removeClass("invisible"),e.addClass("visible"),$("#prevHelpPage").button({disabled:!1}),0===e.next().length&&$("#nextHelpPage").button({disabled:!0})}function prevHelpPage(){document.getElementById("helpContent").scrollTop=0;var t=$(".helpPage.visible"),e=t.prev();t.removeClass("visible"),t.addClass("invisible"),e.removeClass("invisible"),e.addClass("visible"),$("#nextHelpPage").button({disabled:!1}),0===e.prev().length&&$("#prevHelpPage").button({disabled:!0})}$(document).ready(function(){$(document).tooltip(),$(".button").button(),$("#chooseColor").button(),$(".radioButton").checkboxradio({icon:!1}),$(".radioButtonGroup").controlgroup(),$("#saveDialog").dialog({autoOpen:!1,height:400,width:460}),$("#downloadDialog").dialog({autoOpen:!1}),$("#helpDialog").dialog({autoOpen:!1,height:400,width:500});var t=document.getElementById("myCanvas");AlDrawModule.resizeCanvas(),AlDrawModule.setContext(t.getContext("2d")),AlDrawModule.initContext(),AlDrawModule.setDefaultView(),$(window).resize(function(){AlDrawModule.resizeCanvas(),AlDrawModule.initContext(),AlDrawModule.updateView()}),$("#myCanvas").mousewheel(function(t){t.deltaY>0?AlDrawModule.converter.zoomIn(t.offsetX,t.offsetY):AlDrawModule.converter.zoomOut(t.offsetX,t.offsetY),AlDrawModule.updateView()}),$("#myCanvas").mousedown(function(t){AlDrawModule.getInputStrategy().press(t.offsetX,t.offsetY)}),$("#myCanvas").mouseup(function(t){AlDrawModule.getInputStrategy().release(t.offsetX,t.offsetY)}),$("#myCanvas").click(function(t){AlDrawModule.getInputStrategy().click(t.offsetX,t.offsetY)}),$("#myCanvas").mousemove(function(t){AlDrawModule.getInputStrategy().drag(t.offsetX,t.offsetY)});var e=function(e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},n=function(t){for(var n=[],s=0;s<t.length;s++)n.push(e(t[s]));return n};t.addEventListener("touchstart",function(t){if(t.preventDefault(),t.stopImmediatePropagation(),1===t.touches.length){var s=e(t.touches[0]);AlDrawModule.getInputStrategy().press(s.x,s.y)}else AlDrawModule.multiTouchHandler.touchStart(n(t.touches))},{passive:!1}),t.addEventListener("touchmove",function(t){if(t.preventDefault(),t.stopImmediatePropagation(),AlDrawModule.multiTouchHandler.multiTouchMode)AlDrawModule.multiTouchHandler.touchMove(n(t.touches));else{var s=e(t.touches[0]);AlDrawModule.getInputStrategy().drag(s.x,s.y)}},{passive:!1}),t.addEventListener("touchend",function(t){if(t.preventDefault(),t.stopImmediatePropagation(),AlDrawModule.multiTouchHandler.multiTouchMode)AlDrawModule.multiTouchHandler.touchEnd(n(t.touches));else{var s=e(t.changedTouches[0]);AlDrawModule.getInputStrategy().release(s.x,s.y)}},{passive:!1}),$(document).keydown(function(t){t.ctrlKey&&32===t.which?AlDrawModule.clear():t.ctrlKey&&65===t.which?(t.preventDefault(),AlDrawModule.autoZoom()):t.ctrlKey&&(89===t.which||t.shiftKey&&90===t.which)?AlDrawModule.redo():t.ctrlKey&&90===t.which&&AlDrawModule.undo()})});