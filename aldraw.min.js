"use strict";function clickModeGroup(a){$(".modeGroup").hide(),$("."+a).show(),AlDrawModule.setInputStrategy($('[name="'+a+'"]:checked').val())}function markChecked(a){document.getElementById(a).checked=!0,$(".relatedButtons").checkboxradio("refresh")}function nextHelpPage(){document.getElementById("helpContent").scrollTop=0;var a=$(".helpPage.visible"),b=a.next();a.removeClass("visible"),a.addClass("invisible"),b.removeClass("invisible"),b.addClass("visible"),$("#prevHelpPage").button({disabled:!1}),0===b.next().length&&$("#nextHelpPage").button({disabled:!0})}function prevHelpPage(){document.getElementById("helpContent").scrollTop=0;var a=$(".helpPage.visible"),b=a.prev();a.removeClass("visible"),a.addClass("invisible"),b.removeClass("invisible"),b.addClass("visible"),$("#nextHelpPage").button({disabled:!1}),0===b.prev().length&&$("#prevHelpPage").button({disabled:!0})}String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return-1!==d&&d===b});var AlDrawModule=function(){function b(a,b,c){this.red=a,this.green=b,this.blue=c}function c(a,b){this.x=a,this.y=b}function d(b,c,d,e){var f,g,h=b.comparePathableTo(d),i=b.comparePathableTo(e);if(h===c&&i!==c)return-1;if(i===c&&h!==c)return 1;var j=b.distanceAlong(d),k=b.distanceAlong(e),l=b.angleDifference(d);-1===h&&a.floatsEqual(l,0)&&(l=2*Math.PI);var m=b.angleDifference(e);return-1===i&&a.floatsEqual(m,0)&&(m=2*Math.PI),h===c?a.floatsEqual(j,k)?a.floatsEqual(l,m)?(f=d.curvature(),g=e.curvature(),a.floatsEqual(f,g)?0:f>g?-c:c):l>m?-c:c:j<k?-1:1:a.floatsEqual(j,k)?a.floatsEqual(l,m)?(f=d.curvature(),g=e.curvature(),a.floatsEqual(f,g)?0:f>g?-c:c):l>m?-c:c:j<k?1:-1}function g(a,b){this.slope=a,this.intercept=b}function h(a,b){this.start=a,this.angle=b}function i(a,b){this.p1=a,this.p2=b}function j(a,b){this.center=a,this.radius=b}function k(a,b,c,d,e){this.center=a,this.radius=b,this.start=c,this.sweep=d,this.inverse=void 0!==e&&e}function l(a,b){this.path=a,this.color=b}function m(){this.width=1500,this.height=500,this.cX=0,this.cY=0,this.conversionRatio=250,this.angle=0,this.zoomAmt=1.2}function n(){this.enclosures=[],this.segments=[],this.rays=[],this.lines=[],this.arcs=[],this.circles=[],this.points=[],this.next=null,this.previous=null}function p(a,b){this.name=a,this.pointsNeeded=b}function O(){var a=document.getElementById("myCanvas");a.width=0,a.height=0,a.width=$("#viewport").width(),a.height=$("#viewport").height(),Q.width=a.width,Q.height=a.height}function Z(a){U=a}function _(a){X=a}function aa(){return X}function ba(){X.lineWidth=2}function ca(a){var b=Q.screenToAbstractCoord(a),c=P.nearestPoint(b);return Q.abstractToScreenDist(b.dist(c))<20?c:b}function da(a){ea(P.nearestPoint(Q.screenToAbstractCoord(a)))}function ea(a){for(var b=!0,c=S.length,d=0;d<c;d++)if(a.equals(S[d])){b=!1;break}b&&S.push(a),ha()}function fa(a){var b=P.copy();a(b),ga(b),S=[],ha()}function ga(a){P.next=a,a.previous=P,P=a,ya("autosave",!1)}function ha(){X.clearRect(0,0,X.canvas.width,X.canvas.height),X.fillStyle="#fafafa",X.fillRect(0,0,X.canvas.width,X.canvas.height),X.strokeStyle="black",P.draw(X,Q,V,W);for(var c=S.length,d=0;d<c;d++)S[d].draw(X,Q,new b(255,0,0));for(X.strokeStyle="lightgray",c=T.length,d=0;d<c;d++)T[d].draw(X,Q,new b(190,190,190));$("#angle").val(a.round(a.toDegrees(Q.angle),-6))}function ia(){return R}function ja(a){S=[],T=[];for(var b=o.length,c=0;c<b;c++)o[c].name===a&&(R=o[c]);ha()}function ka(){return P}function la(){var a=new n;a.start(),ga(a),S=[],pa()}function ma(){S=[],null!==P.previous&&(P=P.previous,ha())}function na(){S=[],null!==P.next&&(P=P.next,ha())}function oa(){Q.autoZoom(P),ha()}function pa(){Q.conversionRatio=Math.min(Q.width,Q.height)/2-1,Q.cX=0,Q.cY=0,Q.angle=0,ha()}function qa(){Q.conversionRatio=Q.conversionRatio*Q.zoomAmt,ha()}function ra(){Q.conversionRatio=Q.conversionRatio/Q.zoomAmt,ha()}function sa(b){var c=Number(b);NaN!==c&&(Q.angle=a.toRadians(c)),ha()}function ta(a){V=a,ha()}function ua(a){W=a,ha()}function wa(){if(!va){var a=document.getElementById("saveDialogContents");for(var b in Y){var c=Y[b],d=document.createElement("input");d.id="saveDialogInput"+b,d.value=b,d.className="saveDialogRadio",d.setAttribute("type","radio"),d.setAttribute("name","saveDialogRadio"),d.onclick=function(){document.getElementById("saveFilename").value=this.value};var e=document.createElement("label");e.setAttribute("for","saveDialogInput"+b);var f=document.createElement("div");f.innerHTML=b;var g=document.createElement("canvas"),h=100;g.height=h,g.width=h;var i=g.getContext("2d"),j=new m;j.height=h,j.width=h,j.setValues(c.converter),j.conversionRatio=j.conversionRatio*h/Math.min(c.converter.height,c.converter.width);n.fromObject(c.state).draw(i,j,!0,!1),e.appendChild(f),e.appendChild(g),a.appendChild(d),a.appendChild(e)}$(".saveDialogRadio").checkboxradio({icon:!1}),va=!0}}function xa(){va=!1;var a=document.getElementById("saveDialogContents"),b=a.cloneNode(!1);a.parentNode.replaceChild(b,a)}function ya(a,b){var c={state:P,converter:Q.copy()};b&&void 0!==Y[a]&&!confirm("Are you sure you want to overwrite "+a+"?")||(Y[a]=c,localStorage.setItem("saves",JSON.stringify(Y)),$("#saveDialog").dialog("close"),xa())}function za(a){var b=Y[a];if(void 0===b)alert("There is no save named "+a+".");else{Q.setValues(b.converter);ga(n.fromObject(b.state)),ha(),$("#saveDialog").dialog("close")}}function Aa(a){confirm("Are you sure you want to delete "+a+"?")&&(delete Y[a],localStorage.setItem("saves",JSON.stringify(Y)),xa(),wa())}function Ba(a){var b=document.getElementById("myCanvas"),c=document.createElement("canvas");c.width=b.width,c.height=b.height;var d=c.getContext("2d");d.lineWidth=2,P.draw(d,Q,V,!1);var e=c.toDataURL("image/png"),f=document.createElement("a");""===a?a="aldraw.png":a.endsWith(".png")||(a+=".png"),f.download=a,f.href=e,f.click()}function Ca(b){function c(a){var b=Q.abstractToScreenCoord(a.p1),c=Q.abstractToScreenCoord(a.p2);return'<line x1="'+b.x+'" y1="'+b.y+'" x2="'+c.x+'" y2="'+c.y+'" style="stroke:#000000;"/>'}for(var d,e,f,g,h='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+Q.width+'px" height="'+Q.height+'px">',i=P.enclosures.length,j=0;j<i;j++){var k=P.enclosures[j],l=Q.abstractToScreenCoord(k.path[0].startPoint());h+='<path d="M '+l.x+" "+l.y;for(var m=0;m<k.path.length;m++){var n=k.path[m];if(n.isA("Segment"))l=Q.abstractToScreenCoord(n.p2),h+=" L "+l.x+" "+l.y;else if(a.floatsEqual(n.sweep,2*Math.PI)){var o=Q.abstractToScreenCoord(n.getPointAtAngle(a.angleSum(n.start,Math.PI)));e=Q.abstractToScreenCoord(n.getPointAtAngle(n.start)),d=Q.abstractToScreenDist(n.radius),g=1,n.inverse&&(g=0),h+=" A "+d+" "+d+" 0 0 "+g+" "+o.x+" "+o.y,h+=" A "+d+" "+d+" 0 1 "+g+" "+e.x+" "+e.y}else e=Q.abstractToScreenCoord(n.getPointAtAngle(n.getEnd())),d=Q.abstractToScreenDist(n.radius),f=0,n.sweep>Math.PI&&(f=1),g=1,n.inverse&&(e=Q.abstractToScreenCoord(n.getPointAtAngle(n.start)),g=0),h+=" A "+d+" "+d+" 0 "+f+" "+g+" "+e.x+" "+e.y}h+='" fill="'+k.color+'" fill-rule="evenodd" stroke="none"/>'}for(i=P.segments.length,j=0;j<i;j++){var p=P.segments[j];h+=c(p)}for(i=P.rays.length,j=0;j<i;j++){p=P.rays[j].getPortionInsideRectangle(Q.getAbstractBoundaries()),null!==p&&(h+=c(p))}for(i=P.lines.length,j=0;j<i;j++){p=P.lines[j].getPortionInsideRectangle(Q.getAbstractBoundaries()),null!==p&&(h+=c(p))}for(i=P.arcs.length,j=0;j<i;j++){var s=P.arcs[j],t=Q.abstractToScreenCoord(s.getPointAtAngle(s.start));e=Q.abstractToScreenCoord(s.getPointAtAngle(s.getEnd())),d=Q.abstractToScreenDist(s.radius),f=0,s.sweep>Math.PI&&(f=1),h+='<path d="M'+t.x+" "+t.y+" A"+d+" "+d+" 0 "+f+" 1 "+e.x+" "+e.y+'" style="stroke:#000000; fill:none"/>'}for(i=P.circles.length,j=0;j<i;j++){var u=P.circles[j],v=Q.abstractToScreenCoord(u.center);d=Q.abstractToScreenDist(u.radius),h+='<circle cx="'+v.x+'" cy="'+v.y+'" r="'+d+'" style="stroke:#000000; fill:none"/>'}h+="</svg>";var w=new Blob([h]),x=window.URL.createObjectURL(w),y=document.createElement("a");""===b?b="aldraw.svg":b.endsWith(".svg")||(b+=".svg"),y.download=b,y.href=x,y.click()}var a={defaultTolerance:1e-5,isBetween:function(a,b,c){return a<=b+this.defaultTolerance&&a>=c-this.defaultTolerance||a>=b-this.defaultTolerance&&a<=c+this.defaultTolerance},floatsEqual:function(a,b){return!Number.isFinite(a)&&!Number.isFinite(b)||Math.abs(a-b)<this.defaultTolerance},round:function(a,b){var c=Math.pow(10,-b);return Math.round(a*c)/c},midPoint:function(a,b){return new c((a.x+b.x)/2,(a.y+b.y)/2)},perpendicularSlope:function(b){var c=Number.POSITIVE_INFINITY;return a.floatsEqual(b,0)||(c=-1/b),c},comparePointToLine:function(b,c){var d=c.getSlope(),e=c.getIntercept(),f=0;if(Number.isFinite(d)){var g=d*b.x+e;f=a.floatsEqual(b.y,g)?0:b.y>g?1:-1}else f=a.floatsEqual(b.x,e)?0:b.x>e?1:-1;return f},normalizeAngle:function(a){var b=a%(2*Math.PI);return b<0&&(b+=2*Math.PI),this.floatsEqual(b,2*Math.PI)&&(b=0),b},angleSum:function(b,c){var d=b+c;return a.normalizeAngle(d)},angleDifference:function(b,c){var d=b-c;return d=a.normalizeAngle(d)},smallerAngleDifference:function(b,c){return Math.min(a.angleDifference(b,c),a.angleDifference(c,b))},oppositeAngle:function(b){return a.angleSum(b,Math.PI)},angleToSlope:function(b){var c=Math.tan(b);return(a.floatsEqual(b,Math.PI/2)||a.floatsEqual(b,3*Math.PI/2))&&(c=Number.POSITIVE_INFINITY),c},slopeToAngle:function(b){var c=Math.atan(b);return c=a.normalizeAngle(c)},toRadians:function(a){return a*Math.PI/180},toDegrees:function(a){return 180*a/Math.PI},arrayContains:function(a,b){for(var c=a.length,d=0;d<c;d++)if(b.equals(a[d]))return!0;return!1},arrayIndexOf:function(a,b,c){void 0===c&&(c=0);for(var d=a.length,e=c;e<d;e++)if(b.equals(a[e]))return e;return-1},arrayLastIndexOf:function(a,b){for(var c=a.length-1;c>=0;c--)if(b.equals(a[c]))return c;return-1}};b.prototype.toString=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"},b.prototype.darker=function(){return new b(4*this.red/5,4*this.green/5,4*this.blue/5)},c.fromObject=function(a){return new c(a.x,a.y)},c.prototype.dist=function(a){return Math.hypot(this.x-a.x,this.y-a.y)},c.prototype.angle=function(b){var c=Math.atan2(b.y-this.y,b.x-this.x);return c=a.normalizeAngle(c)},c.prototype.translate=function(a,b){return new c(this.x+a,this.y+b)},c.prototype.rotateAroundOrigin=function(a){return new c(Math.cos(a)*this.x-Math.sin(a)*this.y,Math.sin(a)*this.x+Math.cos(a)*this.y)},c.prototype.equals=function(b){return a.floatsEqual(this.x,b.x)&&a.floatsEqual(this.y,b.y)},c.prototype.draw=function(a,c,d){void 0===d&&(d=new b(0,255,0));var e=c.abstractToScreenCoord(this),f=a.fillStyle;a.fillStyle=d.darker().toString(),a.beginPath(),a.arc(e.x,e.y,6,0,2*Math.PI),a.fill(),a.fillStyle=d.toString(),a.beginPath(),a.arc(e.x,e.y,3,0,2*Math.PI),a.fill(),a.fillStyle=f};var e={intersect:function(a){return a.isA("AbstractLine")?this.intersectLine(a):a.isA("Circle")?this.intersectCircle(a):void console.log("This should never happen")},angleDifference:function(b){var c=this.angleAtPoint(b.startPoint()),d=b.angleAtStart();return a.angleDifference(d,c)},comparePathableTo:function(b){var c=this.angleDifference(b);return a.floatsEqual(c,0)?a.floatsEqual(b.curvature(),this.curvature())?0:b.curvature()<this.curvature()?-1:1:a.floatsEqual(c,Math.PI)?a.floatsEqual(b.curvature(),-this.curvature())?0:b.curvature()<-this.curvature()?1:-1:c<Math.PI?1:-1},comparePointTo:function(a){var b=this.closestPoint(a),c=new i(b,a);return this.comparePathableTo(c)},getIntersectionsInOrder:function(b,c){for(var e=[],f=c.getPathables(),g=f.length,h=0;h<g;h++)for(var i=f[h],j=this.intersect(i),l=0;l<j.length;l++)if(null!==j[l]&&!j[l].equals(this.startPoint()))for(var m=i.divide(j[l]),n=0;n<m.length;n++)(this.canSwitchSides()||this.comparePathableTo(m[n])===b)&&e.push(m[n]);var o=this;if(e.sort(function(a,c){return d(o,b,a,c)}),this.isA("arc")&&a.floatsEqual(this.sweep,2*Math.PI)){for(var p=[],f=c.getPathables(),h=0;h<f.length;h++)for(var i=f[h],j=this.intersect(i),l=0;l<j.length;l++)if(null!==j[l]&&j[l].equals(this.startPoint()))for(var m=i.divide(j[l]),n=0;n<m.length;n++)this.comparePathableTo(m[n])===b&&p.push(m[n]);p.sort(function(a,c){return d(o,b,a,c)}),e=e.concat(p),e.push(new k(this.center,this.radius,this.start,this.sweep,this.inverse))}return e}},f=Object.create(e);f.getSlope=function(){console.log("getSlope() hasn't been implemented"),console.trace()},f.getIntercept=function(){console.log("getIntercept() hasn't been implemented"),console.trace()},f.contains=function(){console.log("contains() hasn't been implemented"),console.trace()},f.distance=function(a){var b=this.getSlope(),c=this.getIntercept(),d=a.x,e=a.y;return Number.isFinite(b)?Math.abs(e-b*d-c)/Math.hypot(b,1):Math.abs(d-c)},f.curvature=function(){return 0},f.intersectLine=function(b){var d=this.getSlope(),e=this.getIntercept(),f=b.getSlope(),g=b.getIntercept();if(a.floatsEqual(d,f))return[];var h,i;Number.isFinite(d)?Number.isFinite(f)?(h=(g-e)/(d-f),i=d*h+e):(h=g,i=d*h+e):(h=e,i=f*h+g);var j=new c(h,i);return this.contains(j)&&b.contains(j)?[j]:[]},f.intersectCircle=function(b){var d=b.center.x,e=b.center.y,f=b.radius,g=this.getSlope(),h=this.getIntercept(),i=[],j=[];if(a.floatsEqual(this.distance(b.center),f)){var k=this.closestPoint(b.center);return b.contains(k)?[k]:[]}if(Number.isFinite(g)){var l=1+Math.pow(g,2),m=2*(g*h-d-g*e),n=Math.pow(d,2)+Math.pow(h,2)-2*h*e+Math.pow(e,2)-Math.pow(f,2),o=Math.pow(m,2)-4*l*n;if(o<0)return[];var p=(-m+Math.sqrt(o))/(2*l);i.push(new c(p,g*p+h)),p=(-m-Math.sqrt(o))/(2*l),i.push(new c(p,g*p+h))}else{if(h<d-f||h>d+f)return[];i.push(new c(h,e+Math.sqrt(Math.pow(f,2)-Math.pow(h-d,2)))),i.push(new c(h,e-Math.sqrt(Math.pow(f,2)-Math.pow(h-d,2))))}var q,r=i.length;for(q=0;q<r;q++)this.contains(i[q])&&b.contains(i[q])&&j.push(i[q]);return j},f.parallel=function(b){return a.floatsEqual(this.getSlope(),b.getSlope())},f.same=function(b){return a.floatsEqual(this.getSlope(),b.getSlope())&&a.floatsEqual(this.getIntercept(),b.getIntercept())},g.fromObject=function(a){return new g(a.slope,a.intercept)},g.fromTwoPoints=function(b,c){var d,e;return d=a.floatsEqual(b.x,c.x)?Number.POSITIVE_INFINITY:(c.y-b.y)/(c.x-b.x),e=Number.isFinite(d)?b.y-d*b.x:b.x,new g(d,e)},g.fromPointSlope=function(a,b){var c;return c=Number.isFinite(b)?a.y-b*a.x:a.x,new g(b,c)},g.prototype=Object.create(f),g.prototype.isA=function(a){return"Line"===a||"AbstractLine"===a},g.prototype.getSlope=function(){return this.slope},g.prototype.getIntercept=function(){return this.intercept},g.prototype.closestPoint=function(b){var c=0;a.floatsEqual(this.getSlope(),0)?c=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(c=-1/this.getSlope());var d=g.fromPointSlope(b,c);return this.intersectLine(d)[0]},g.prototype.canSwitchSides=function(){return!1},g.prototype.divide=function(b){this.contains(b)||(b=this.closestPoint(b));var c=a.slopeToAngle(this.slope);return[new h(b,c),new h(b,a.oppositeAngle(c))]},g.prototype.contains=function(b){return Number.isFinite(this.slope)?a.floatsEqual(b.y,this.slope*b.x+this.intercept):a.floatsEqual(this.intercept,b.x)},g.prototype.getPortionInsideRectangle=function(b){for(var c=[],d=b.length,e=0;e<d;e++)for(var f=this.intersectLine(b[e]),g=f.length,h=0;h<g;h++)a.arrayContains(c,f[h])||c.push(f[h]);return c.length>=2?new i(c[0],c[1]):null},g.prototype.draw=function(a,b){var c=b.getAbstractBoundaries(),d=this.getPortionInsideRectangle(c);null!=d&&d.draw(a,b)},g.prototype.equals=function(b){return this===b||null!==b&&void 0!==b&&(!!b.isA("Line")&&(a.floatsEqual(this.intercept,other.intercept)&&a.floatsEqual(this.slope,other.slope)))},h.fromObject=function(a){return new h(c.fromObject(a.start),a.angle)},h.fromTwoPoints=function(a,b){return new h(a,a.angle(b))},h.prototype=Object.create(f),h.prototype.isA=function(a){return"Ray"===a||"AbstractLine"===a},h.prototype.getSlope=function(){return a.floatsEqual(this.angle,Math.PI/2)?Number.POSITIVE_INFINITY:a.floatsEqual(this.angle,3*Math.PI/2)?Number.NEGATIVE_INFINITY:Math.tan(this.angle)},h.prototype.getIntercept=function(){var a=this.getSlope();return Number.isFinite(a)?this.start.y-a*this.start.x:this.start.x},h.prototype.closestPoint=function(b){var c=0;a.floatsEqual(this.getSlope(),0)?c=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(c=-1/this.getSlope());var d=g.fromPointSlope(b,c),e=this.intersectLine(d);return e.length>0?e[0]:this.start},h.prototype.startPoint=function(){return this.start},h.prototype.angleAtStart=function(){return this.angle},h.prototype.angleAtPoint=function(a){return this.angle},h.prototype.canSwitchSides=function(){return!1},h.prototype.distance=function(a){return this.closestPoint(a).dist(a)},h.prototype.distanceAlong=function(a){var b=a.startPoint();return this.start.dist(b)},h.prototype.divide=function(a){return this.contains(a)||(a=this.closestPoint(a)),this.start.equals(a)?[new h(a,this.angle)]:[new i(a,this.start),new h(a,this.angle)]},h.prototype.shortened=function(a){return new i(this.startPoint(),a.startPoint())},h.prototype.contains=function(b){var c=this.start.angle(b);return a.floatsEqual(c,this.angle)||b.equals(this.start)},h.prototype.getPortionInsideRectangle=function(b){for(var c=[this.start],d=b.length,e=0;e<d;e++)for(var f=this.intersectLine(b[e]),g=f.length,h=0;h<g;h++)a.arrayContains(c,f[h])||c.push(f[h]);return 2===c.length?new i(c[0],c[1]):c.length>2?new i(c[1],c[2]):null},h.prototype.sameDirection=function(a){return this.equals(a)},h.prototype.draw=function(a,b){var c=b.getAbstractBoundaries(),d=this.getPortionInsideRectangle(c);null!=d&&d.draw(a,b)},h.prototype.equals=function(b){return this===b||null!==b&&void 0!==b&&(!!b.isA("Ray")&&(this.start.equals(b.start)&&a.floatsEqual(this.angle,b.angle)))},i.fromObject=function(a){return new i(c.fromObject(a.p1),c.fromObject(a.p2))},i.prototype=Object.create(f),i.prototype.isA=function(a){return"Segment"===a||"AbstractLine"===a},i.prototype.getSlope=function(){return a.floatsEqual(this.p1.x,this.p2.x)?1/0:(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)},i.prototype.getIntercept=function(){var a=this.getSlope();return Number.isFinite(a)?this.p1.y-a*this.p1.x:this.p1.x},i.prototype.closestPoint=function(b){var c=0;a.floatsEqual(this.getSlope(),0)?c=Number.POSITIVE_INFINITY:Number.isFinite(this.getSlope())&&(c=-1/this.getSlope());var d=g.fromPointSlope(b,c),e=this.intersectLine(d);return e.length>0?e[0]:b.dist(this.p1)>b.dist(this.p2)?this.p2:this.p1},i.prototype.contains=function(b){var c=this.p1.x,d=this.p1.y,e=b.x,f=b.y,g=this.p2.x,h=this.p2.y,i=this.getSlope(),j=!Number.isFinite(i)&&a.floatsEqual(e,c)||a.floatsEqual(f-d,i*(e-c));return j=j&&a.isBetween(e,c,g)&&a.isBetween(f,d,h)},i.prototype.startPoint=function(){return this.p1},i.prototype.angleAtStart=function(){return this.p1.angle(this.p2)},i.prototype.angleAtPoint=function(a){return this.angleAtStart()},i.prototype.canSwitchSides=function(){return!0},i.prototype.distance=function(a){return this.closestPoint(a).dist(a)},i.prototype.distanceAlong=function(a){var b=a.startPoint();return this.p1.dist(b)},i.prototype.divide=function(a){return this.contains(a)||(a=this.closestPoint(a)),this.p1.equals(a)?[new i(a,this.p2)]:this.p2.equals(a)?[new i(a,this.p1)]:[new i(a,this.p1),new i(a,this.p2)]},i.prototype.shortened=function(a){return new i(this.startPoint(),a.startPoint())},i.prototype.sameDirection=function(a){return!!a.isA("Segment")&&(this.p1.equals(a.p1)&&this.p2.equals(a.p2))},i.prototype.isIn=function(a){return a.contains(this.p1)&&a.contains(this.p2)},i.prototype.draw=function(a,b){var c=b.abstractToScreenCoord(this.p1),d=b.abstractToScreenCoord(this.p2);a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(d.x,d.y),a.stroke()},i.prototype.equals=function(a){return this===a||null!==a&&void 0!==a&&(!!a.isA("Segment")&&(this.p1.equals(a.p1)&&this.p2.equals(a.p2)||this.p1.equals(a.p2)&&this.p2.equals(a.p1)))},j.fromObject=function(a){return new j(c.fromObject(a.center),a.radius)},j.prototype=Object.create(e),j.prototype.isA=function(a){return"Circle"===a},j.prototype.contains=function(b){return a.floatsEqual(b.dist(this.center),this.radius)},j.prototype.getPointAtAngle=function(a){return new c(this.center.x+this.radius*Math.cos(a),this.center.y+this.radius*Math.sin(a))},j.prototype.intersectLine=function(a){return a.intersectCircle(this)},j.prototype.intersectCircle=function(b){var c,d=this.radius,e=b.radius,f=this.center.dist(b.center),g=this.center.angle(b.center);if(this.center.equals(b.center))return[];if(a.floatsEqual(f,d+e))return c=this.center.translate(d*Math.cos(g),d*Math.sin(g)),this.contains(c)&&b.contains(c)?[c]:[];if(a.floatsEqual(f,Math.abs(d-e)))return c=this.center.translate(d*Math.cos(g),d*Math.sin(g)),d<e&&(c=this.center.translate(d*Math.cos(a.oppositeAngle(g)),d*Math.sin(a.oppositeAngle(g)))),this.contains(c)&&b.contains(c)?[c]:[];if(f>d+e||f<Math.abs(d-e))return[];var h=[],i=Math.acos((Math.pow(d,2)+Math.pow(f,2)-Math.pow(e,2))/(2*d*f));return c=this.center.translate(d*Math.cos(g+i),d*Math.sin(g+i)),this.contains(c)&&b.contains(c)&&h.push(c),c=this.center.translate(d*Math.cos(g-i),d*Math.sin(g-i)),this.contains(c)&&b.contains(c)&&h.push(c),h},j.prototype.canSwitchSides=function(){return!1},j.prototype.distance=function(a){return Math.abs(this.center.dist(a)-this.radius)},j.prototype.curvature=function(){return 1/this.radius},j.prototype.closestPoint=function(a){var b=this.center.angle(a);return this.getPointAtAngle(b)},j.prototype.divide=function(a){this.contains(a)||(a=this.closestPoint(a));var b=this.center.angle(a),c=[];return c.push(new k(this.center,this.radius,b,2*Math.PI,!1)),c.push(new k(this.center,this.radius,b,2*Math.PI,!0)),c},j.prototype.draw=function(a,b){var c=b.abstractToScreenCoord(this.center),d=b.abstractToScreenDist(this.radius);a.beginPath(),a.arc(c.x,c.y,d,0,2*Math.PI),a.stroke()},j.prototype.same=function(b){return this.center.equals(b.center)&&a.floatsEqual(this.radius,b.radius)},j.prototype.equals=function(a){return this===a||null!==a&&void 0!==a&&(!(!a.isA("Circle")||a.isA("Arc"))&&this.same(a))},k.fromObject=function(a){return new k(c.fromObject(a.center),a.radius,a.start,a.sweep,a.inverse)},k.fromThreePoints=function(b,c,d){var e=b,f=b.dist(c),g=b.angle(c);return new k(e,f,g,a.angleDifference(b.angle(d),g))},k.prototype=Object.create(j.prototype),k.prototype.isA=function(a){return"Arc"===a||"Circle"===a},k.prototype.getEnd=function(){return a.angleSum(this.start,this.sweep)},k.prototype.contains=function(b){var c=this.center.dist(b);if(!a.floatsEqual(c,this.radius))return!1;var d=this.center.angle(b);return a.angleDifference(d,this.start)<this.sweep||a.floatsEqual(d,this.start)||a.floatsEqual(d,this.getEnd())},k.prototype.angleAtPoint=function(b){return this.inverse?a.angleDifference(this.center.angle(b),Math.PI/2):a.angleSum(this.center.angle(b),Math.PI/2)},k.prototype.startPoint=function(){return this.inverse?this.getPointAtAngle(this.getEnd()):this.getPointAtAngle(this.start)},k.prototype.angleAtStart=function(){return this.angleAtPoint(this.startPoint())},k.prototype.curvature=function(){var a=1/this.radius;return this.inverse&&(a*=-1),a},k.prototype.canSwitchSides=function(){return!a.floatsEqual(this.sweep,2*Math.PI)},k.prototype.distance=function(a){return this.closestPoint(a).dist(a)},k.prototype.closestPoint=function(a){var b=this.center.angle(a),c=this.getPointAtAngle(b);if(this.contains(c))return c;var d=this.getPointAtAngle(this.start),e=this.getPointAtAngle(this.getEnd());return a.dist(d)<a.dist(e)?d:e},k.prototype.distanceAlong=function(b){var c=b.startPoint(),d=this.center.angle(c),e=a.angleDifference(d,this.start);return this.inverse&&(e=a.angleDifference(this.getEnd(),d)),e},k.prototype.divide=function(b){this.contains(b)||(b=this.closestPoint(b));var c=this.center.angle(b);if(a.floatsEqual(c,this.start))return[new k(this.center,this.radius,this.start,this.sweep,!1)];if(a.floatsEqual(c,this.getEnd()))return[new k(this.center,this.radius,this.start,this.sweep,!0)];var d=[];return d.push(new k(this.center,this.radius,c,a.angleDifference(this.getEnd(),c),!1)),d.push(new k(this.center,this.radius,this.start,a.angleDifference(c,this.start),!0)),d},k.prototype.shortened=function(b){var c=this.start,d=this.center.angle(b.startPoint());this.inverse&&(c=this.center.angle(b.startPoint()),d=this.getEnd());var e=a.angleDifference(d,c);return a.floatsEqual(e,0)&&(e=2*Math.PI),new k(this.center,this.radius,c,e,this.inverse)},k.prototype.sameDirection=function(a){return!!a.isA("Arc")&&(this.equals(a)&&this.inverse===a.inverse)},k.prototype.isIn=function(b){var c=a.angleDifference(this.start,b.start)<=b.sweep,d=this.sweep<a.angleDifference(b.getEnd(),this.start);return c&&d},k.prototype.draw=function(b,c){var d=c.abstractToScreenCoord(this.center),e=c.abstractToScreenDist(this.radius),f=a.angleSum(this.start,c.angle),g=a.angleSum(this.getEnd(),c.angle);b.beginPath(),b.arc(d.x,d.y,e,f,g),b.stroke()},k.prototype.equals=function(b){return this===b||null!==b&&void 0!==b&&(!!b.isA("Arc")&&(this.center.equals(b.center)&&a.floatsEqual(this.radius,b.radius)&&a.floatsEqual(this.start,b.start)&&a.floatsEqual(this.sweep,b.sweep)))},l.fromObject=function(a){for(var b=[],c=a.path.length,d=0;d<c;d++){var e=a.path[d];void 0!==e.p1?b.push(i.fromObject(e)):void 0!==e.sweep?b.push(k.fromObject(e)):console.log("This should never happen (Enclosure.fromObject)")}return new l(b,a.color)},l.findEnclosure=function(b,c){var d,e,f,g,h=null,i=c.getPathables();for(i.sort(function(c,d){var e=c.distance(b),f=d.distance(b);if(a.floatsEqual(e,f)){if(c.isA("Circle")&&d.isA("Circle")){var g=c.center.dist(b),h=d.center.dist(b);return a.floatsEqual(g,h)?0:g<h?-1:1}return 0}return e<f?-1:1}),f=i.length,d=0;d<f;d++){var j=i[d],k=j.divide(j.closestPoint(b));for(g=k.length,e=0;e<g;e++){var m=k[e].comparePointTo(b);if(null!==(h=l.findEnclosureRecurse(b,[],k[e],m,c))&&h.contains(b))return h}}return null},l.findEnclosureRecurse=function(b,c,d,e,f){var g,h,i=null,j=d.getIntersectionsInOrder(e,f);for(h=j.length,g=0;g<h;g++){i=c.slice(0);var k=j[g],m=d.shortened(k),n=a.arrayIndexOf(i,m);if(n!==a.arrayLastIndexOf(i,m)||a.arrayContains(i,m)&&m.sameDirection(i[n]))return i=i.slice(n),new l(i);i.push(m);var o=l.findEnclosureRecurse(b,i,k,e,f);if(null!==o)return o}return null},l.prototype.contains=function(a){for(var b=new h(a,0),c=new h(a,Math.PI),d=0,e=0,f=0;f<this.path.length;f++){var g=this.path[f],i=b.intersect(g);d+=i.length,i=c.intersect(g),e+=i.length}return d%2==e%2&&d%2!=0},l.prototype.draw=function(b,c){b.fillStyle=this.color,b.beginPath();var d=c.abstractToScreenCoord(this.path[0].startPoint());b.moveTo(d.x,d.y);for(var e=0;e<this.path.length;e++){var f=this.path[e];if(f.isA("Segment"))d=c.abstractToScreenCoord(f.p2),b.lineTo(d.x,d.y);else if(f.isA("Arc")){d=c.abstractToScreenCoord(f.center);var g=c.abstractToScreenDist(f.radius),h=a.angleSum(f.start,c.angle),i=a.angleSum(f.getEnd(),c.angle);a.floatsEqual(f.sweep,2*Math.PI)&&(i=f.start+2*Math.PI),f.inverse?b.arc(d.x,d.y,g,i,h,!0):b.arc(d.x,d.y,g,h,i,!1)}else console.log("Enclosure.draw invalid enclosure"),console.log(this.path),console.log(f)}b.closePath(),b.fill()},m.prototype.setValues=function(a){void 0!==a.cX&&(this.cX=a.cX),void 0!==a.cY&&(this.cY=a.cY),void 0!==a.conversionRatio&&(this.conversionRatio=a.conversionRatio),void 0!==a.angle&&(this.angle=a.angle)},m.prototype.getAbstractBoundaries=function(){var a=this.screenToAbstractCoord(new c(0,0)),b=this.screenToAbstractCoord(new c(this.width,0)),d=this.screenToAbstractCoord(new c(this.width,this.height)),e=this.screenToAbstractCoord(new c(0,this.height)),f=[];return f.push(new i(a,b)),f.push(new i(b,d)),f.push(new i(d,e)),f.push(new i(e,a)),f},m.prototype.zoomIn=function(a,b){this.conversionRatio=this.conversionRatio*this.zoomAmt;var d=this.screenToAbstractCoord(new c(a,b)),e=new c(this.cX,this.cY).angle(d),f=new c(this.cX,this.cY).dist(d);this.cX+=(this.zoomAmt-1)*f*Math.cos(e),this.cY+=(this.zoomAmt-1)*f*Math.sin(e)},m.prototype.zoomOut=function(a,b){var d=this.screenToAbstractCoord(new c(a,b)),e=new c(this.cX,this.cY).angle(d),f=new c(this.cX,this.cY).dist(d);this.cX-=(this.zoomAmt-1)*f*Math.cos(e),this.cY-=(this.zoomAmt-1)*f*Math.sin(e),this.conversionRatio=this.conversionRatio/this.zoomAmt},m.prototype.autoZoom=function(a){function n(a){a.x<b&&(b=a.x),a.x>d&&(d=a.x),a.y<e&&(e=a.y),a.y>f&&(f=a.y)}var b,d,e,f,g,h,i,j,k,l,m;for(i=a.points[0].rotateAroundOrigin(this.angle),b=d=i.x,e=f=i.y,h=a.points.length,g=1;g<h;g++)i=a.points[g].rotateAroundOrigin(this.angle),n(i);for(h=a.arcs.length,g=0;g<h;g++)l=a.arcs[g],k=l.center.rotateAroundOrigin(this.angle),i=k.translate(-l.radius,0),j=i.rotateAroundOrigin(-this.angle),l.contains(j)&&n(i),i=k.translate(l.radius,0),j=i.rotateAroundOrigin(-this.angle),l.contains(j)&&n(i),i=k.translate(0,-l.radius),j=i.rotateAroundOrigin(-this.angle),l.contains(j)&&n(i),i=k.translate(0,l.radius),j=i.rotateAroundOrigin(-this.angle),l.contains(j)&&n(i);for(h=a.circles.length,g=0;g<h;g++)m=a.circles[g],k=m.center.rotateAroundOrigin(this.angle),i=k.translate(-m.radius,0),n(i),i=k.translate(m.radius,0),n(i),i=k.translate(0,-m.radius),n(i),i=k.translate(0,m.radius),n(i);this.conversionRatio=Math.min((this.width-2)/(d-b),(this.height-2)/(f-e)),i=new c((d+b)/2,(f+e)/2),i=i.rotateAroundOrigin(-this.angle),this.cX=i.x,this.cY=i.y},m.prototype.abstractToScreenDist=function(a){return a*this.conversionRatio},m.prototype.screenToAbstractDist=function(a){return a/this.conversionRatio},m.prototype.abstractToScreenCoord=function(a){var b=(a.x-this.cX)*this.conversionRatio,d=(a.y-this.cY)*this.conversionRatio,e=new c(b,d);return e=e.rotateAroundOrigin(this.angle),e.x=e.x+this.width/2,e.y=e.y+this.height/2,e},m.prototype.screenToAbstractCoord=function(a){var b=a.x-this.width/2,d=a.y-this.height/2,e=new c(b,d);return e=e.rotateAroundOrigin(-this.angle),e.x=e.x/this.conversionRatio+this.cX,e.y=e.y/this.conversionRatio+this.cY,e},m.prototype.copy=function(){var a=new m;return a.cX=this.cX,a.cY=this.cY,a.conversionRatio=this.conversionRatio,a.anlge=this.angle,a.height=this.height,a.width=this.width,a},m.prototype.toJSON=function(){return{cX:this.cX,cY:this.cY,conversionRatio:this.conversionRatio,angle:this.angle,height:this.height,width:this.width}},n.fromObject=function(a){var d,e,b=new n;for(e=a.enclosures.length,d=0;d<e;d++)b.enclosures.push(l.fromObject(a.enclosures[d]));for(e=a.segments.length,d=0;d<e;d++)b.segments.push(i.fromObject(a.segments[d]));for(e=a.rays.length,d=0;d<e;d++)b.rays.push(h.fromObject(a.rays[d]));for(e=a.lines.length,d=0;d<e;d++)b.lines.push(g.fromObject(a.lines[d]));for(e=a.arcs.length,d=0;d<e;d++)b.arcs.push(k.fromObject(a.arcs[d]));for(e=a.circles.length,d=0;d<e;d++)b.circles.push(j.fromObject(a.circles[d]));for(e=a.points.length,d=0;d<e;d++)b.points.push(c.fromObject(a.points[d]));return b},n.prototype.start=function(){var a,b=1;for(this.circles.push(new j(new c(0,0),1)),this.points.push(new c(0,0)),a=0;a<6;a++)this.points.push(new c(b*Math.cos(a*Math.PI/3),b*Math.sin(a*Math.PI/3)))},n.prototype.getTopEnclosure=function(a){for(var b=this.enclosures.length-1;b>=0;b--)if(this.enclosures[b].contains(a))return this.enclosures[b];return null},n.prototype.getPathables=function(){var a=this.segments.concat(this.rays);return a=a.concat(this.lines),a=a.concat(this.arcs),a=a.concat(this.circles)},n.prototype.nearestPoint=function(a){for(var b=this.points[0],c=a.dist(b),d=this.points.length,e=1;e<d;e++){var f=this.points[e];a.dist(f)<c&&(b=f,c=a.dist(b))}return b},n.prototype.addEnclosure=function(a){this.enclosures.push(a)},n.prototype.addAllIntersections=function(a){var b,c;for(c=this.segments.length,b=0;b<c;b++)this.addPoints(a.intersectLine(this.segments[b]));for(c=this.rays.length,b=0;b<c;b++)this.addPoints(a.intersectLine(this.rays[b]));for(c=this.lines.length,b=0;b<c;b++)this.addPoints(a.intersectLine(this.lines[b]));for(c=this.arcs.length,b=0;b<c;b++)this.addPoints(a.intersectCircle(this.arcs[b]));for(c=this.circles.length,b=0;b<c;b++)this.addPoints(a.intersectCircle(this.circles[b]))},n.prototype.addSegmentWithIntersections=function(a){this.addAllIntersections(a),this.addSegmentWithoutIntersections(a)},n.prototype.addSegmentWithoutIntersections=function(a){var b,c;for(c=this.lines.length,b=0;b<c;b++)if(a.same(this.lines[b]))return;for(c=this.rays.length,b=0;b<c;b++){var d=this.rays[b];if(a.same(d)){if(d.contains(a.p1)&&d.contains(a.p2))return;if(d.contains(a.p1))return this.rays.splice(b,1),void this.addRayWithoutIntersections(new h(a.p2,d.angle));if(d.contains(a.p2))return this.rays.splice(b,1),void this.addRayWithoutIntersections(new h(a.p1,d.angle))}}for(c=this.segments.length,b=0;b<c;b++){var e=this.segments[b];if(a.same(e)){if(a.isIn(e))return;e.isIn(a)?(this.segments.splice(b,1),b--,c--):a.contains(e.p1)&&e.contains(a.p1)?(a=new i(a.p2,e.p2),this.segments.splice(b,1),b--,c--):a.contains(e.p1)&&e.contains(a.p2)?(a=new i(a.p1,e.p2),this.segments.splice(b,1),b--,c--):a.contains(e.p2)&&e.contains(a.p1)?(a=new i(a.p2,e.p1),this.segments.splice(b,1),b--,c--):a.contains(e.p2)&&e.contains(a.p2)&&(a=new i(a.p1,e.p1),this.segments.splice(b,1),b--,c--)}}this.segments.push(a)},n.prototype.addRayWithIntersections=function(a){this.addAllIntersections(a),this.addRayWithoutIntersections(a)},n.prototype.addRayWithoutIntersections=function(b){var c,d;for(d=this.lines.length,c=0;c<d;c++)if(b.same(this.lines[c]))return;for(d=this.rays.length,c=0;c<d;c++){var e=this.rays[c];if(b.same(e))if(a.floatsEqual(b.angle,e.angle)){if(!b.contains(e.start))return;this.rays.splice(c,1),c--,d--}else if(b.contains(e.start))return this.rays.splice(c,1),void this.addLineWithoutIntersections(new g(b.getSlope(),b.getIntercept()))}for(d=this.segments.length,c=0;c<d;c++){var f=this.segments[c];b.same(f)&&(b.contains(f.p1)&&b.contains(f.p2)?(this.segments.splice(c,1),c--,d--):b.contains(f.p1)?(b=new h(f.p2,b.angle),this.segments.splice(c,1),c--,d--):b.contains(f.p2)&&(b=new h(f.p1,b.angle),this.segments.splice(c,1),c--,d--))}this.rays.push(b)},n.prototype.addLineWithIntersections=function(a){this.addAllIntersections(a),this.addLineWithoutIntersections(a)},n.prototype.addLineWithoutIntersections=function(a){function d(b){return!a.same(b)}var b,c;for(c=this.lines.length,b=0;b<c;b++)if(a.same(this.lines[b]))return;this.segments=this.segments.filter(d),this.rays=this.rays.filter(d),this.lines.push(a)},n.prototype.addArcWithIntersections=function(a){this.addAllIntersections(a),this.addArcWithoutIntersections(a)},n.prototype.addArcWithoutIntersections=function(b){var c,d;for(d=this.circles.length,c=0;c<d;c++)if(b.same(this.circles[c]))return;for(d=this.arcs.length,c=0;c<d;c++){var e=this.arcs[c];if(b.same(e)){if(b.isIn(e))return;if(e.isIn(b))this.arcs.splice(c,1),c--,d--;else{if(a.floatsEqual(b.start,e.getEnd())&&a.floatsEqual(b.getEnd(),e.start))return this.arcs.splice(c,1),void this.addCircleWithoutIntersections(new j(b.center,b.radius));if(a.floatsEqual(b.start,e.getEnd())&&a.angleDifference(b.getEnd(),e.start)<e.sweep)return this.arcs.splice(c,1),void this.addCircleWithoutIntersections(new j(b.center,b.radius));if(a.angleDifference(b.start,e.start)<e.sweep&&a.angleDifference(b.getEnd(),e.start)<e.sweep)return this.arcs.splice(c,1),void this.addCircleWithoutIntersections(new j(b.center,b.radius));a.angleDifference(b.start,e.start)<e.sweep?(this.arcs.splice(c,1),c--,d--,b=new k(b.center,b.radius,e.start,a.angleDifference(b.getEnd(),e.start))):a.angleDifference(b.getEnd(),e.start)<e.sweep&&(this.arcs.splice(c,1),c--,d--,b=new k(b.center,b.radius,b.start,a.angleDifference(e.getEnd(),b.start)))}}}this.arcs.push(b)},n.prototype.addCircleWithIntersections=function(a){this.addAllIntersections(a),this.addCircleWithoutIntersections(a)},n.prototype.addCircleWithoutIntersections=function(a){function d(b){return!a.same(b)}var b,c;for(c=this.circles.length,b=0;b<c;b++)if(a.same(this.circles[b]))return;this.arcs=this.arcs.filter(d),this.circles.push(a)},n.prototype.addPoint=function(a){this.points.push(a)},n.prototype.addPoints=function(b){for(var c=b.length,d=0;d<c;d++)a.arrayContains(this.points,b[d])||this.points.push(b[d])},n.prototype.removeEnclosure=function(a){var b,c;for(c=this.enclosures.length,b=0;b<c;b++)this.enclosures[b].contains(a)&&(this.enclosures.splice(b,1),b--,c--)},n.prototype.removeSegment=function(b){var c,d;for(d=this.segments.length,c=0;c<d;c++){var e=this.segments[c];if(b.same(e))if(b.equals(e)||e.isIn(b))this.segments.splice(c,1),c--,d--;else if(b.isIn(e)){var f=e.p1,g=e.p2,j=b.p1,k=b.p2;a.floatsEqual(f.x,g.x)?(g.y<f.y&&(f=e.p2,g=e.p1),k.y<j.y&&(j=b.p2,k=b.p1)):(g.x<f.x&&(f=e.p2,g=e.p1),k.x<j.x&&(j=b.p2,k=b.p1)),this.segments.splice(c,1),this.addSegmentWithoutIntersections(new i(f,j)),this.addSegmentWithoutIntersections(new i(k,g)),c--,d--}else b.contains(e.p1)?(this.segments.splice(c,1),e.contains(b.p1)?this.addSegmentWithoutIntersections(new i(b.p1,e.p2)):this.addSegmentWithoutIntersections(new i(b.p2,e.p2)),c--,d--):b.contains(e.p2)&&(this.segments.splice(c,1),e.contains(b.p1)?this.addSegmentWithoutIntersections(new i(b.p1,e.p1)):this.addSegmentWithoutIntersections(new i(b.p2,e.p1)),c--,d--)}for(d=this.rays.length,c=0;c<d;c++){var l=this.rays[c];if(b.same(l))if(l.contains(b.p1)&&l.contains(b.p2)){var m=new i(l.start,b.p1),n=b.p2;m.contains(b.p2)&&(m=new i(l.start,b.p2),n=b.p1),this.rays.splice(c,1),this.addRayWithoutIntersections(new h(n,l.angle)),m.p1.equals(m.p2)||this.addSegmentWithoutIntersections(m),c--,d--}else l.contains(b.p1)&&!l.start.equals(b.p1)?(this.rays.splice(c,1),this.addRayWithoutIntersections(new h(b.p1,l.angle)),c--,d--):l.contains(b.p2)&&!l.start.equals(b.p2)&&(this.rays.splice(c,1),this.addRayWithoutIntersections(new h(b.p2,l.angle)),c--,d--)}for(d=this.lines.length,c=0;c<d;c++){var o=this.lines[c];if(b.same(o)){var p=a.slopeToAngle(o.slope),q=a.oppositeAngle(p),r=new h(b.p1,p),s=new h(b.p2,q);(r.contains(b.p2)||s.contains(b.p1))&&(r=new h(b.p1,q),s=new h(b.p2,p)),this.lines.splice(c,1),this.addRayWithoutIntersections(r),this.addRayWithoutIntersections(s),c--,d--}}},n.prototype.removeRay=function(b){var c,d;for(d=this.segments.length,c=0;c<d;c++){var e=this.segments[c];b.same(e)&&(b.contains(e.p1)&&b.contains(e.p2)?(this.segments.splice(c,1),c--,d--):b.contains(e.p1)?(this.segments.splice(c,1),this.addSegmentWithoutIntersections(new i(e.p2,b.start)),c--,d--):b.contains(e.p2)&&(this.segments.splice(c,1),this.addSegmentWithoutIntersections(new i(e.p1,b.start)),c--,d--))}for(d=this.rays.length,c=0;c<d;c++){var f=this.rays[c];b.same(f)&&(a.floatsEqual(b.angle,f.angle)?b.contains(f.start)?(this.rays.splice(c,1),c--,d--):(this.rays.splice(c,1),this.addSegmentWithoutIntersections(new i(b.start,f.start)),c--,d--):b.contains(f.start)&&!b.start.equals(f.start)&&(this.rays.splice(c,1),this.addRayWithoutIntersections(new h(b.start,f.angle)),c--,d--))}for(d=this.lines.length,c=0;c<d;c++){var g=this.lines[c];b.same(g)&&(this.lines.splice(c,1),this.addRayWithoutIntersections(new h(b.start,a.oppositeAngle(b.angle))),c--,d--)}},n.prototype.removeLine=function(a){var b,c;for(c=this.segments.length,b=0;b<c;b++){var d=this.segments[b];a.same(d)&&(this.segments.splice(b,1),b--,c--)}for(c=this.rays.length,b=0;b<c;b++){var e=this.rays[b];a.same(e)&&(this.rays.splice(b,1),b--,c--)}for(c=this.lines.length,b=0;b<c;b++){var f=this.lines[b];a.same(f)&&(this.lines.splice(b,1),b--,c--)}},n.prototype.removeArc=function(b){var c,d;for(d=this.arcs.length,c=0;c<d;c++){var e=this.arcs[c];b.same(e)&&(b.equals(e)||e.isIn(b)?(this.arcs.splice(c,1),c--,d--):b.isIn(e)?(this.arcs.splice(c,1),a.floatsEqual(b.start,e.start)||this.addArcWithoutIntersections(new k(b.center,b.radius,e.start,a.angleDifference(b.start,e.start))),a.floatsEqual(e.getEnd(),b.getEnd())||this.addArcWithoutIntersections(new k(b.center,b.radius,b.getEnd(),a.angleDifference(e.getEnd(),b.getEnd()))),c--,d--):a.angleDifference(b.start,e.start)<e.sweep&&a.angleDifference(b.getEnd(),e.start)<e.sweep?(this.arcs.splice(c,1),this.addArcWithoutIntersections(new k(b.center,b.radius,b.getEnd(),a.angleDifference(b.start,b.getEnd()))),c--,d--):a.angleDifference(b.start,e.start)<e.sweep?(this.arcs.splice(c,1),this.addArcWithoutIntersections(new k(b.center,b.radius,e.start,a.angleDifference(b.start,e.start))),c--,d--):a.angleDifference(b.getEnd(),e.start)<e.sweep&&(this.arcs.splice(c,1),this.addArcWithoutIntersections(new k(b.center,b.radius,b.getEnd(),a.angleDifference(e.getEnd(),b.getEnd()))),c--,d--))}for(d=this.circles.length,c=0;c<d;c++){var f=this.circles[c];b.same(f)&&(this.circles.splice(c,1),this.addArcWithoutIntersections(new k(b.center,b.radius,b.getEnd(),a.angleDifference(2*Math.PI,b.sweep))),c--,d--)}},n.prototype.removeCircle=function(a){var b,c;for(c=this.arcs.length,b=0;b<c;b++){var d=this.arcs[b];a.same(d)&&(this.arcs.splice(b,1),b--,c--)}for(c=this.circles.length,b=0;b<c;b++){var e=this.circles[b];a.same(e)&&(this.circles.splice(b,1),b--,c--)}},n.prototype.removePoint=function(a){var b,c;for(c=this.points.length,b=0;b<c;b++)a.equals(this.points[b])&&(this.points.splice(b,1),b--,c--)},n.prototype.copy=function(){var c=new n;return c.enclosures=this.enclosures.slice(0),c.segments=this.segments.slice(0),c.rays=this.rays.slice(0),c.lines=this.lines.slice(0),c.arcs=this.arcs.slice(0),c.circles=this.circles.slice(0),c.points=this.points.slice(0),c},n.prototype.draw=function(a,b,c,d){var e,f;for(f=this.enclosures.length,e=0;e<f;e++)this.enclosures[e].draw(a,b);if(c){for(f=this.segments.length,e=0;e<f;e++)this.segments[e].draw(a,b);for(f=this.rays.length,e=0;e<f;e++)this.rays[e].draw(a,b);for(f=this.lines.length,e=0;e<f;e++)this.lines[e].draw(a,b);for(f=this.arcs.length,e=0;e<f;e++)this.arcs[e].draw(a,b);for(f=this.circles.length,e=0;e<f;e++)this.circles[e].draw(a,b)}if(d)for(f=this.points.length,e=0;e<f;e++)this.points[e].draw(a,b)},n.prototype.toJSON=function(){return{enclosures:this.enclosures,segments:this.segments,rays:this.rays,lines:this.lines,arcs:this.arcs,circles:this.circles,points:this.points}};var o=[];p.prototype.shadowHook1=function(a){return[]},p.prototype.shadowHook2=function(a,b){return this.shadowHook1(a)},p.prototype.shadowHook3=function(a,b,c){return this.shadowHook2(a,b)},p.prototype.press=function(a,b){da(new c(a,b)),S.length===this.pointsNeeded&&(T=[],this.endHook(),S=[])},p.prototype.release=function(a,b){1===S.length&&this.press(a,b)},p.prototype.click=function(a,b){this.release(a,b)},p.prototype.drag=function(a,b){var d=ca(new c(a,b));0===S.length?T=this.shadowHook1(d):1===S.length?T=this.shadowHook2(S[0],d):2===S.length&&(T=this.shadowHook3(S[0],S[1],d)),ha()};var q=new p("Draw Segment",2);q.shadowHook2=function(a,b){return[new i(a,b)]},q.endHook=function(){fa(function(a){a.addSegmentWithIntersections(new i(S[0],S[1]))})},o.push(q);var r=new p("Draw Ray",2);r.shadowHook2=function(a,b){return[h.fromTwoPoints(a,b)]},r.endHook=function(){fa(function(a){a.addRayWithIntersections(h.fromTwoPoints(S[0],S[1]))})},o.push(r);var s=new p("Draw Line",2);s.shadowHook2=function(a,b){return[g.fromTwoPoints(a,b)]},s.endHook=function(){fa(function(a){a.addLineWithIntersections(g.fromTwoPoints(S[0],S[1]))})},o.push(s);var t=new p("Draw Arc",3);t.shadowHook2=function(a,b){return[new j(a,a.dist(b))]},t.shadowHook3=function(a,b,c){return[k.fromThreePoints(a,b,c)]},t.endHook=function(){fa(function(a){a.addArcWithIntersections(k.fromThreePoints(S[0],S[1],S[2]))})},o.push(t);var u=new p("Draw Circle",2);u.shadowHook2=function(a,b){return[new j(a,a.dist(b))]},u.endHook=function(){fa(function(a){a.addCircleWithIntersections(new j(S[0],S[0].dist(S[1])))})},o.push(u);var v=new p("Erase Segment",2);v.shadowHook2=q.shadowHook2,v.endHook=function(){fa(function(a){a.removeSegment(new i(S[0],S[1]))})},o.push(v);var w=new p("Erase Ray",2);w.shadowHook2=r.shadowHook2,w.endHook=function(){fa(function(a){a.removeRay(h.fromTwoPoints(S[0],S[1]))})},o.push(w);var x=new p("Erase Line",2);x.shadowHook2=s.shadowHook2,x.endHook=function(){fa(function(a){a.removeLine(g.fromTwoPoints(S[0],S[1]))})},o.push(x);var y=new p("Erase Arc",3);y.shadowHook2=t.shadowHook2,y.shadowHook3=t.shadowHook3,y.endHook=function(){fa(function(a){a.removeArc(k.fromThreePoints(S[0],S[1],S[2]))})},o.push(y);var z=new p("Erase Circle",2);z.shadowHook2=u.shadowHook2,z.endHook=function(){fa(function(a){a.removeCircle(new j(S[0],S[0].dist(S[1])))})},o.push(z);var A=new p("Erase Point",1);A.shadowHook1=function(a){return[a]},A.endHook=function(){fa(function(a){a.removePoint(S[0])})},o.push(A);var B=new p("Midpoint",2);B.shadowHook2=function(b,c){return[a.midPoint(b,c)]},B.endHook=function(){fa(function(b){b.addPoint(a.midPoint(S[0],S[1]))})},o.push(B);var C=new p("Trisect",2);C.calculatePoints=function(a,b){var d=b.x-a.x,e=b.y-a.y,f=a.x+d/3,g=a.y+e/3,h=a.x+2*d/3,i=a.y+2*e/3;return[new c(f,g),new c(h,i)]},C.shadowHook2=function(a,b){return this.calculatePoints(a,b)},C.endHook=function(){var a=this.calculatePoints(S[0],S[1]);fa(function(b){b.addPoints(a)})},o.push(C);var D=new p("Perpendicular Bisector",2);D.calculateLine=function(b,c){var d=a.midPoint(b,c),e=g.fromTwoPoints(b,c),f=e.getSlope();return g.fromPointSlope(d,a.perpendicularSlope(f))},D.shadowHook2=function(b,c){return[this.calculateLine(b,c),a.midPoint(b,c)]},D.endHook=function(){var b=this.calculateLine(S[0],S[1]);fa(function(c){c.addPoint(a.midPoint(S[0],S[1])),c.addLineWithIntersections(b)})},o.push(D);var E=new p("Angle Bisector",3);E.calculateLine=function(b,c,d){var e=c.angle(b),f=c.angle(d),h=(e+f)/2,i=a.angleToSlope(h);return g.fromPointSlope(c,i)},E.shadowHook2=function(a,b){return[g.fromTwoPoints(a,b)]},E.shadowHook3=function(a,b,c){return[this.calculateLine(a,b,c)]},E.endHook=function(){var a=this.calculateLine(S[0],S[1],S[2]);fa(function(b){b.addLineWithIntersections(a)})},o.push(E);var F=new p("Tangent Line",2);F.calculateLine=function(b,c){var d=g.fromTwoPoints(b,c),e=d.getSlope();return g.fromPointSlope(c,a.perpendicularSlope(e))},F.shadowHook2=function(a,b){return[this.calculateLine(a,b)]},F.endHook=function(){var a=this.calculateLine(S[0],S[1]);fa(function(b){b.addLineWithIntersections(a)})},o.push(F);var G=new p("Parallel Line",3);G.calculateLine=function(a,b,c){var d=g.fromTwoPoints(a,b),e=d.getSlope();return g.fromPointSlope(c,e)},G.shadowHook2=function(a,b){return[g.fromTwoPoints(a,b)]},G.shadowHook3=function(a,b,c){return[this.calculateLine(a,b,c)]},G.endHook=function(){var a=this.calculateLine(S[0],S[1],S[2]);fa(function(b){b.addLineWithIntersections(a)})},o.push(G);var H=new p("Circumscribe Triangle",3);H.calculateCenter=function(b,c,d){var e=g.fromTwoPoints(b,c);e=g.fromPointSlope(a.midPoint(b,c),a.perpendicularSlope(e.getSlope()));var f=g.fromTwoPoints(c,d);f=g.fromPointSlope(a.midPoint(c,d),a.perpendicularSlope(f.getSlope()));var h=e.intersectLine(f);return h.length>0?h[0]:null},H.shadowHook2=function(b,c){var d=a.midPoint(b,c);return[d,new j(d,d.dist(b))]},H.shadowHook3=function(a,b,c){var d=this.calculateCenter(a,b,c);return null===d?[]:[d,new j(d,d.dist(a))]},H.calculateCircle=function(a,b,c){var d=this.calculateCenter(a,b,c);return null===d?null:new j(d,d.dist(a))},H.endHook=function(){var a=this.calculateCenter(S[0],S[1],S[2]);if(null!==a){var b=this.calculateCircle(S[0],S[1],S[2]);fa(function(c){c.addPoint(a),c.addCircleWithIntersections(b)})}},o.push(H);var I=new p("Compass",3);I.shadowHook2=function(a,b){return[new j(a,a.dist(b))]},I.shadowHook3=function(a,b,c){return[new j(c,a.dist(b))]},I.endHook=function(){fa(function(a){a.addCircleWithIntersections(new j(S[2],S[0].dist(S[1])))})},o.push(I);var J=new p("Fill Color",0);J.press=function(){},J.release=function(a,b){var d=Q.screenToAbstractCoord(new c(a,b)),e=l.findEnclosure(d,P);null!==e&&(e.color=U,fa(function(a){a.addEnclosure(e)}))},J.click=function(){},J.drag=function(){},o.push(J);var K=new p("Erase Color",0);K.press=function(){},K.release=function(a,b){var d=Q.screenToAbstractCoord(new c(a,b));fa(function(a){a.removeEnclosure(d)})},K.click=function(){},K.drag=function(){},o.push(K);var L=new p("Pick Color",0);L.press=function(){},L.release=function(a,b){var d=Q.screenToAbstractCoord(new c(a,b)),e=P.getTopEnclosure(d);null!==e&&(U=e.color,$("#chooseColor").val(e.color))},L.click=function(){},L.drag=function(){},o.push(L);var M=new p("Pan",0);M.oldPoint=null,M.press=function(a,b){this.oldPoint=Q.screenToAbstractCoord(new c(a,b))},M.release=function(a,b){this.oldPoint=null},M.click=function(){},M.drag=function(a,b){if(null!==this.oldPoint){var d=Q.screenToAbstractCoord(new c(a,b)),e=d.x-this.oldPoint.x,f=d.y-this.oldPoint.y;Q.cX=Q.cX-e,Q.cY=Q.cY-f,ha()}},o.push(M);var N=new p("Rotate",0);N.oldAngle=null,N.press=function(a,b){var d=new c(Q.cX,Q.cY);this.oldAngle=d.angle(Q.screenToAbstractCoord(new c(a,b)))},N.release=function(a,b){this.oldAngle=null},N.click=function(){},N.drag=function(b,d){if(null!==this.oldAngle){var e=new c(Q.cX,Q.cY),f=e.angle(Q.screenToAbstractCoord(new c(b,d))),g=f-this.oldAngle;Q.angle=a.angleSum(Q.angle,g),ha()}},o.push(N);var P=new n,Q=new m;P.start();var X,R=u,S=[],T=[],U="#ff0000",V=!0,W=!0,Y={};null!==localStorage.getItem("saves")&&(Y=JSON.parse(localStorage.getItem("saves")));var va=!1;return{converter:Q,getCurrentState:ka,getInputStrategy:ia,setInputStrategy:ja,setColor:Z,setContext:_,getContext:aa,initContext:ba,resizeCanvas:O,updateView:ha,clear:la,undo:ma,redo:na,autoZoom:oa,setDefaultView:pa,zoomIn:qa,zoomOut:ra,setAngle:sa,setShowLines:ta,setShowPoints:ua,generateSaveDialog:wa,save:ya,load:za,deleteSave:Aa,saveAsPNG:Ba,saveAsSVG:Ca}}();$(document).ready(function(){$(document).tooltip(),$(".button").button(),$("#chooseColor").button(),$(".radioButton").checkboxradio({icon:!1}),$(".radioButtonGroup").controlgroup(),$("#saveDialog").dialog({autoOpen:!1,height:400,width:460}),$("#downloadDialog").dialog({autoOpen:!1}),$("#helpDialog").dialog({autoOpen:!1,height:400,width:500});var a=document.getElementById("myCanvas");AlDrawModule.resizeCanvas(),AlDrawModule.setContext(a.getContext("2d")),AlDrawModule.initContext(),AlDrawModule.setDefaultView(),$(window).resize(function(){AlDrawModule.resizeCanvas(),AlDrawModule.initContext(),AlDrawModule.updateView()}),$("#myCanvas").mousewheel(function(a){a.deltaY>0?AlDrawModule.converter.zoomIn(a.offsetX,a.offsetY):AlDrawModule.converter.zoomOut(a.offsetX,a.offsetY),AlDrawModule.updateView()}),$("#myCanvas").mousedown(function(a){AlDrawModule.getInputStrategy().press(a.offsetX,a.offsetY)}),$("#myCanvas").mouseup(function(a){AlDrawModule.getInputStrategy().release(a.offsetX,a.offsetY)}),$("#myCanvas").click(function(a){AlDrawModule.getInputStrategy().click(a.offsetX,a.offsetY)}),$("#myCanvas").mousemove(function(a){AlDrawModule.getInputStrategy().drag(a.offsetX,a.offsetY)}),$(document).keydown(function(a){a.ctrlKey&&32===a.which?AlDrawModule.clear():a.ctrlKey&&65===a.which?(a.preventDefault(),AlDrawModule.autoZoom()):a.ctrlKey&&(89===a.which||a.shiftKey&&90===a.which)?AlDrawModule.redo():a.ctrlKey&&90===a.which&&AlDrawModule.undo()})});